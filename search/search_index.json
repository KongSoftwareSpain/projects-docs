{"config":{"lang":["es"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Documentaci\u00f3n de Proyectos","text":"<p>Bienvenido al \u00edndice general de documentaci\u00f3n.</p>"},{"location":"#proyectos","title":"Proyectos","text":"<ul> <li>Proyecto Ejemplo - Ejemplo de referencia: as\u00ed es como se debe documentar.</li> <li>Fichaje App</li> </ul>"},{"location":"fichaje_app/","title":"Documentaci\u00f3n del Proyecto Fichaje","text":"<p>Bienvenido a la documentaci\u00f3n del sistema de gesti\u00f3n de fichajes, proyectos y servicios empresariales.</p>"},{"location":"fichaje_app/#indice-general","title":"\ud83d\udccb \u00cdndice General","text":""},{"location":"fichaje_app/#arquitectura","title":"\ud83c\udfd7\ufe0f Arquitectura","text":"<ul> <li>Vista General de la Arquitectura - Descripci\u00f3n completa de la arquitectura del sistema</li> <li>Infraestructura y Despliegue - Topolog\u00eda de servidores y bases de datos</li> <li>Decisiones Arquitect\u00f3nicas - Decisiones t\u00e9cnicas importantes y advertencias</li> </ul>"},{"location":"fichaje_app/#guias","title":"\ud83d\udcd6 Gu\u00edas","text":"<ul> <li>Convenciones de C\u00f3digo - Est\u00e1ndares y convenciones del proyecto</li> </ul>"},{"location":"fichaje_app/#onboarding","title":"\ud83d\ude80 Onboarding","text":"<ul> <li>Introducci\u00f3n al Proyecto - Gu\u00eda de inicio para nuevos desarrolladores</li> <li>Configuraci\u00f3n del Entorno - Setup del entorno de desarrollo</li> </ul>"},{"location":"fichaje_app/#descripcion-general-del-proyecto","title":"\ud83c\udfaf Descripci\u00f3n General del Proyecto","text":"<p>Fichaje es una aplicaci\u00f3n empresarial completa para la gesti\u00f3n de:</p> <ul> <li>\u23f0 Control de asistencia y fichajes de empleados</li> <li>\ud83d\udcca Gesti\u00f3n de proyectos y \u00f3rdenes de trabajo</li> <li>\ud83d\udcdd Partes de trabajo y seguimiento de actividades</li> <li>\ud83d\udcb0 Notas de gasto</li> <li>\ud83d\udcc4 Albaranes y facturaci\u00f3n</li> <li>\ud83c\udfd6\ufe0f Solicitudes de vacaciones</li> <li>\ud83d\udcc8 Estad\u00edsticas y reportes</li> </ul>"},{"location":"fichaje_app/#stack-tecnologico","title":"\ud83d\udee0\ufe0f Stack Tecnol\u00f3gico","text":""},{"location":"fichaje_app/#backend","title":"Backend","text":"<ul> <li>Runtime: Node.js</li> <li>Framework: Express 5</li> <li>ORM: Sequelize</li> <li>Base de Datos: SQL Server (MSSQL)</li> <li>Autenticaci\u00f3n: JWT (JSON Web Tokens)</li> <li>Almacenamiento: Azure Blob Storage</li> </ul>"},{"location":"fichaje_app/#frontend","title":"Frontend","text":"<ul> <li>Framework: Angular 19</li> <li>UI Components: Angular Material + Bootstrap 5</li> <li>Gr\u00e1ficos: ngx-charts, FullCalendar</li> <li>Gesti\u00f3n de Estado: RxJS + Services</li> <li>PWA: Service Worker habilitado</li> </ul>"},{"location":"fichaje_app/#estructura-del-repositorio","title":"\ud83d\udcc1 Estructura del Repositorio","text":"<pre><code>Fichaje/\n\u251c\u2500\u2500 backend-AppServicios/     # API REST del backend\n\u2502   \u251c\u2500\u2500 controllers/          # L\u00f3gica de negocio\n\u2502   \u251c\u2500\u2500 routes/              # Definici\u00f3n de rutas\n\u2502   \u251c\u2500\u2500 Model/               # Modelos Sequelize\n\u2502   \u251c\u2500\u2500 middleware/          # Middlewares (auth, roles, etc.)\n\u2502   \u251c\u2500\u2500 config/              # Configuraciones\n\u2502   \u2514\u2500\u2500 utils/               # Utilidades y helpers\n\u2502\n\u251c\u2500\u2500 front-AppServicios/      # Aplicaci\u00f3n Angular\n\u2502   \u2514\u2500\u2500 src/\n\u2502       \u2514\u2500\u2500 app/\n\u2502           \u251c\u2500\u2500 components/  # Componentes reutilizables\n\u2502           \u251c\u2500\u2500 pages/       # P\u00e1ginas principales\n\u2502           \u251c\u2500\u2500 services/    # Servicios HTTP\n\u2502           \u251c\u2500\u2500 guards/      # Guards de navegaci\u00f3n\n\u2502           \u251c\u2500\u2500 interceptors/# Interceptores HTTP\n\u2502           \u2514\u2500\u2500 interface/   # Interfaces TypeScript\n\u2502\n\u2514\u2500\u2500 documentacion/           # Esta documentaci\u00f3n\n</code></pre>"},{"location":"fichaje_app/#enlaces-rapidos","title":"\ud83d\udd17 Enlaces R\u00e1pidos","text":"<ul> <li>Repositorio: GitHub</li> <li>Backend API: <code>http://localhost:3000</code></li> <li>Frontend Dev: <code>http://localhost:4200</code></li> </ul>"},{"location":"fichaje_app/#contacto-y-soporte","title":"\ud83d\udcde Contacto y Soporte","text":"<p>Para preguntas o problemas, contacta al equipo de desarrollo interno.</p> <p>\u00daltima actualizaci\u00f3n: Diciembre 2025</p>"},{"location":"fichaje_app/arquitectura/decisiones/","title":"Decisiones Arquitect\u00f3nicas y Advertencias","text":"<p>Este documento detalla las decisiones t\u00e9cnicas importantes del proyecto y las advertencias cr\u00edticas que todo desarrollador debe conocer.</p>"},{"location":"fichaje_app/arquitectura/decisiones/#advertencias-criticas","title":"\u26a0\ufe0f ADVERTENCIAS CR\u00cdTICAS","text":""},{"location":"fichaje_app/arquitectura/decisiones/#integracion-con-erp-antiguo-en-access","title":"\ud83d\udd34 Integraci\u00f3n con ERP Antiguo en Access","text":"<p>[!CAUTION] &gt; CONTEXTO ARQUITECT\u00d3NICO IMPORTANTE: El sistema SQL Server de esta aplicaci\u00f3n se alimenta de datos provenientes de un ERP antiguo basado en Microsoft Access.</p> <p>Contexto real:</p> <ul> <li>La empresa usa un ERP legacy en Access que sigue siendo la fuente principal de los datos</li> <li>SQL Server NO reemplaz\u00f3 a Access, sino que se integra con \u00e9l</li> <li>Los datos fluyen desde el ERP Access hacia SQL Server</li> <li>Esta integraci\u00f3n es intencional y necesaria para el funcionamiento del negocio</li> </ul> <p>Implicaciones en el dise\u00f1o:</p> <p>[!IMPORTANT] Muchas decisiones de dise\u00f1o de la base de datos est\u00e1n condicionadas por el ERP Access. No te asustes por c\u00f3mo est\u00e1 montado, es as\u00ed por necesidad.</p> <p>Campos espec\u00edficos del ERP:</p> <ul> <li><code>id_origen</code>: ID del registro en la base de datos Access original</li> <li>Nombres de campos: Mantienen nomenclatura del ERP legacy</li> <li>Estructura de tablas: Refleja el modelo del ERP Access</li> <li>Relaciones: Algunas est\u00e1n condicionadas por el sistema antiguo</li> </ul> <p>Por qu\u00e9 existe esta integraci\u00f3n:</p> <ul> <li>\u2705 El ERP Access sigue en uso para otras funcionalidades del negocio</li> <li>\u2705 Migraci\u00f3n completa no es viable a corto plazo</li> <li>\u2705 Necesidad de mantener sincronizaci\u00f3n de datos</li> <li>\u2705 Evita duplicaci\u00f3n de trabajo en el ERP legacy</li> </ul> <p>Ubicaci\u00f3n del c\u00f3digo de integraci\u00f3n:</p> <pre><code>// Buscar en el c\u00f3digo por referencias a Access o conexiones ODBC\n// Principalmente en:\n// - Sincronizaci\u00f3n de datos desde Access\n// - Campos como id_origen que referencian IDs de Access\n</code></pre> <p>Recomendaci\u00f3n para desarrolladores:</p> <p>[!NOTE] &gt; NO intentes \"arreglar\" o \"normalizar\" la estructura de la base de datos sin consultar primero. Las decisiones de dise\u00f1o est\u00e1n atadas al ERP legacy por razones de negocio.</p>"},{"location":"fichaje_app/arquitectura/decisiones/#consultas-sql-directas-sin-orm","title":"\ud83d\udfe1 Consultas SQL Directas (Sin ORM)","text":"<p>[!WARNING] Algunos controladores usan consultas SQL directas con el paquete <code>mssql</code> en lugar de Sequelize.</p> <p>Problema:</p> <pre><code>// \u274c MAL - Consulta directa\nconst pool = await mssql.connect(config);\nconst result = await pool.request().query(\"SELECT * FROM USUARIOS\");\n\n// \u2705 BIEN - Usar Sequelize\nconst usuarios = await db.USUARIOS.findAll();\n</code></pre> <p>Por qu\u00e9 es problem\u00e1tico:</p> <ul> <li>No aprovecha las ventajas del ORM (validaciones, relaciones, etc.)</li> <li>C\u00f3digo m\u00e1s dif\u00edcil de mantener</li> <li>Riesgo de SQL injection si no se parametriza correctamente</li> <li>Inconsistencia en el c\u00f3digo</li> </ul> <p>Archivos afectados:</p> <ul> <li>Buscar por <code>require('mssql')</code> en controllers</li> </ul>"},{"location":"fichaje_app/arquitectura/decisiones/#decisiones-arquitectonicas","title":"\ud83c\udfd7\ufe0f Decisiones Arquitect\u00f3nicas","text":""},{"location":"fichaje_app/arquitectura/decisiones/#1-separacion-frontendbackend","title":"1. Separaci\u00f3n Frontend/Backend","text":"<p>Decisi\u00f3n: Arquitectura desacoplada con API REST</p> <p>Razones:</p> <ul> <li>\u2705 Permite desarrollo independiente de frontend y backend</li> <li>\u2705 Facilita escalabilidad horizontal</li> <li>\u2705 Posibilita m\u00faltiples clientes (web, m\u00f3vil futuro)</li> <li>\u2705 Mejor separaci\u00f3n de responsabilidades</li> </ul> <p>Trade-offs:</p> <ul> <li>\u274c Mayor complejidad inicial</li> <li>\u274c Necesidad de gestionar CORS</li> <li>\u274c Dos servidores en desarrollo</li> </ul>"},{"location":"fichaje_app/arquitectura/decisiones/#2-sequelize-como-orm","title":"2. Sequelize como ORM","text":"<p>Decisi\u00f3n: Usar Sequelize para acceso a datos</p> <p>Razones:</p> <ul> <li>\u2705 Abstracci\u00f3n de la base de datos</li> <li>\u2705 Migraciones y seeders</li> <li>\u2705 Validaciones a nivel de modelo</li> <li>\u2705 Relaciones entre modelos</li> </ul> <p>Trade-offs:</p> <ul> <li>\u274c Curva de aprendizaje</li> <li>\u274c Queries complejas pueden ser dif\u00edciles</li> <li>\u274c Overhead de rendimiento en algunos casos</li> </ul> <p>Configuraci\u00f3n espec\u00edfica:</p> <pre><code>// dbConfig.js\n{\n  dialect: \"mssql\",\n  timezone: '+00:00',  // UTC\n  dialectOptions: {\n    options: {\n      instanceName: \"KONGSERVER\",\n      encrypt: false,\n      trustServerCertificate: true\n    }\n  },\n  logging: false  // Deshabilitado en producci\u00f3n\n}\n</code></pre>"},{"location":"fichaje_app/arquitectura/decisiones/#3-jwt-para-autenticacion","title":"3. JWT para Autenticaci\u00f3n","text":"<p>Decisi\u00f3n: JSON Web Tokens (JWT) en lugar de sesiones</p> <p>Razones:</p> <ul> <li>\u2705 Stateless (no requiere almacenamiento en servidor)</li> <li>\u2705 Escalable horizontalmente</li> <li>\u2705 Funciona bien con arquitectura REST</li> <li>\u2705 Incluye informaci\u00f3n del usuario (empresa, rol)</li> </ul> <p>Implementaci\u00f3n:</p> <pre><code>// Payload del token\n{\n  id: usuario.id,\n  nombre: usuario.nombre,\n  empresa: usuario.id_empresa,\n  rol: usuario.rol\n}\n</code></pre> <p>Seguridad:</p> <ul> <li>Token expira en 24 horas</li> <li>Refresh token disponible</li> <li>Secret key en variable de entorno</li> </ul>"},{"location":"fichaje_app/arquitectura/decisiones/#4-multi-tenancy-por-empresa","title":"4. Multi-tenancy por Empresa","text":"<p>Decisi\u00f3n: Transici\u00f3n de modelo Single-tenant (Legacy) a Soft Multi-tenancy (Futuro).</p> <p>[!NOTE] Actualmente coexisten ambos modelos. Ver Infraestructura.</p> <p>Razones del cambio a Multi-tenant (<code>kong1App</code>):</p> <ul> <li>\u2705 Consolidaci\u00f3n: Evitar mantener N servidores para N clientes</li> <li>\u2705 Una sola base de datos para todas las empresas</li> <li>\u2705 M\u00e1s simple de mantener y desplegar</li> <li>\u2705 Costos reducidos</li> </ul> <p>Estado Actual (H\u00edbrido):</p> <ul> <li>Legacy: Servidores dedicados por cliente (<code>AppFichaje</code>, <code>ThrApp</code>, etc.)</li> <li>Moderno: Servidor multi-tenant (<code>kong1App</code>) alojando m\u00faltiples clientes</li> </ul> <p>Implementaci\u00f3n del Multi-tenancy:</p> <p>Implementaci\u00f3n:</p> <ul> <li>Cada tabla tiene <code>id_empresa</code></li> <li>Middleware autom\u00e1tico filtra por empresa del usuario</li> <li>Superadmin puede ver todas las empresas</li> </ul> <p>Seguridad:</p> <pre><code>// Siempre filtrar por empresa\nconst { empresa } = req.user;\nconst data = await db.TABLA.findAll({\n  where: { id_empresa: empresa },\n});\n</code></pre>"},{"location":"fichaje_app/arquitectura/decisiones/#5-azure-blob-storage-para-archivos","title":"5. Azure Blob Storage para Archivos","text":"<p>Decisi\u00f3n: Usar Azure Blob Storage en lugar de sistema de archivos local</p> <p>Razones:</p> <ul> <li>\u2705 Escalable y confiable</li> <li>\u2705 No depende del servidor local</li> <li>\u2705 Facilita despliegue en m\u00faltiples servidores</li> <li>\u2705 Backups autom\u00e1ticos</li> </ul> <p>Trade-offs:</p> <ul> <li>\u274c Costo adicional</li> <li>\u274c Dependencia de servicio externo</li> <li>\u274c Latencia de red</li> </ul> <p>Uso:</p> <ul> <li>Tickets de notas de gasto</li> <li>Documentos adjuntos</li> <li>Exportaciones de Excel</li> </ul>"},{"location":"fichaje_app/arquitectura/decisiones/#6-angular-material-bootstrap","title":"6. Angular Material + Bootstrap","text":"<p>Decisi\u00f3n: Combinar Angular Material con Bootstrap</p> <p>Razones:</p> <ul> <li>\u2705 Material para componentes complejos (tablas, modales)</li> <li>\u2705 Bootstrap para layout y utilidades</li> <li>\u2705 Dise\u00f1o consistente</li> </ul> <p>Trade-offs:</p> <ul> <li>\u274c Tama\u00f1o del bundle m\u00e1s grande</li> <li>\u274c Posibles conflictos de estilos</li> <li>\u274c Dos sistemas de dise\u00f1o</li> </ul>"},{"location":"fichaje_app/arquitectura/decisiones/#7-manejo-de-fechas-transicion-a-date-fns","title":"7. Manejo de Fechas: Transici\u00f3n a date-fns","text":"<p>Decisi\u00f3n actual: Migraci\u00f3n progresiva de js-joda a date-fns</p> <p>[!IMPORTANT] &gt; ESTADO DE TRANSICI\u00d3N: El proyecto est\u00e1 en proceso de migraci\u00f3n de <code>js-joda</code> a <code>date-fns</code>. Actualmente coexisten ambas librer\u00edas.</p> <p>Contexto de la transici\u00f3n:</p> <ul> <li>\u2705 C\u00f3digo nuevo: Usar <code>date-fns</code> y <code>date-fns-tz</code></li> <li>\u26a0\ufe0f C\u00f3digo legacy: A\u00fan usa <code>js-joda</code></li> <li>\ud83d\udd04 Migraci\u00f3n gradual: Se est\u00e1 cambiando poco a poco</li> </ul> <p>Por qu\u00e9 date-fns:</p> <ul> <li>\u2705 M\u00e1s ligero y modular</li> <li>\u2705 Mejor rendimiento</li> <li>\u2705 API m\u00e1s simple y funcional</li> <li>\u2705 Mejor soporte de TypeScript</li> <li>\u2705 Tree-shaking (reduce bundle size)</li> </ul> <p>Configuraci\u00f3n recomendada (c\u00f3digo nuevo):</p> <pre><code>// Backend - date-fns\nconst { format, parseISO, addDays } = require(\"date-fns\");\nconst { zonedTimeToUtc, utcToZonedTime } = require(\"date-fns-tz\");\n\n// Zona horaria\nconst timezone = \"Europe/Madrid\";\nconst ahora = utcToZonedTime(new Date(), timezone);\n</code></pre> <pre><code>// Frontend - date-fns\nimport { format, parseISO, addDays } from \"date-fns\";\nimport { zonedTimeToUtc, utcToZonedTime } from \"date-fns-tz\";\nimport { es } from \"date-fns/locale\";\n\n// Formatear fecha\nconst fechaFormateada = format(new Date(), \"dd/MM/yyyy HH:mm\", { locale: es });\n</code></pre> <p>C\u00f3digo legacy (js-joda):</p> <pre><code>// A\u00fan encontrar\u00e1s esto en c\u00f3digo antiguo\nimport { LocalDateTime, ZoneId } from \"@js-joda/core\";\nconst ahora = LocalDateTime.now(ZoneId.of(\"Europe/Madrid\"));\n</code></pre> <p>Gu\u00eda para desarrolladores:</p> <p>[!NOTE]</p> <ul> <li>Nuevo c\u00f3digo: Usa <code>date-fns</code></li> <li>Modificando c\u00f3digo existente: Puedes mantener <code>js-joda</code> o migrar a <code>date-fns</code> si el cambio es significativo</li> <li>No mezcles: En un mismo archivo/m\u00f3dulo, usa una sola librer\u00eda</li> </ul> <p>[!IMPORTANT] &gt; CR\u00cdTICO: Sequelize con SQL Server y fechas es complicado. Ver Gu\u00eda de Fechas con Sequelize.</p>"},{"location":"fichaje_app/arquitectura/decisiones/#guia-de-fechas-con-sequelize","title":"\ud83d\udcc5 Gu\u00eda de Fechas con Sequelize","text":""},{"location":"fichaje_app/arquitectura/decisiones/#problema-con-sql-server","title":"Problema con SQL Server","text":"<p>SQL Server almacena fechas en formato local del servidor, pero Sequelize asume UTC.</p> <p>Configuraci\u00f3n necesaria:</p> <pre><code>// En dbConfig.js\n{\n  timezone: '+00:00',  // Forzar UTC\n  dialectOptions: {\n    options: {\n      useUTC: true\n    }\n  }\n}\n</code></pre> <p>En los modelos:</p> <pre><code>// Definir campos de fecha\n{\n  fecha: {\n    type: DataTypes.DATE,\n    get() {\n      const rawValue = this.getDataValue('fecha');\n      if (!rawValue) return null;\n\n      // Convertir a js-joda\n      return LocalDateTime.parse(rawValue.toISOString().slice(0, -1));\n    }\n  }\n}\n</code></pre> <p>Recursos \u00fatiles:</p> <ul> <li>Sequelize Timezone Issues</li> <li>js-joda Documentation</li> </ul>"},{"location":"fichaje_app/arquitectura/decisiones/#seguridad","title":"\ud83d\udd12 Seguridad","text":""},{"location":"fichaje_app/arquitectura/decisiones/#buenas-practicas-implementadas","title":"Buenas Pr\u00e1cticas Implementadas","text":"<p>\u2705 Autenticaci\u00f3n:</p> <ul> <li>JWT con expiraci\u00f3n</li> <li>Passwords hasheados con bcrypt (10 rounds)</li> <li>Refresh tokens</li> </ul> <p>\u2705 Autorizaci\u00f3n:</p> <ul> <li>Middleware de roles</li> <li>Verificaci\u00f3n por empresa (multi-tenancy)</li> <li>Rutas protegidas</li> </ul> <p>\u2705 Validaci\u00f3n:</p> <ul> <li>Validaci\u00f3n de entrada en controllers</li> <li>Sanitizaci\u00f3n de datos</li> </ul>"},{"location":"fichaje_app/arquitectura/decisiones/#areas-de-mejora","title":"\u26a0\ufe0f \u00c1reas de Mejora","text":"<p>\u274c Falta implementar:</p> <ul> <li>Rate limiting</li> <li>HTTPS obligatorio en producci\u00f3n</li> <li>Validaci\u00f3n m\u00e1s estricta de inputs</li> <li>Logs de auditor\u00eda</li> <li>Encriptaci\u00f3n de datos sensibles en BD</li> </ul>"},{"location":"fichaje_app/arquitectura/decisiones/#rendimiento","title":"\ud83d\ude80 Rendimiento","text":""},{"location":"fichaje_app/arquitectura/decisiones/#optimizaciones-implementadas","title":"Optimizaciones Implementadas","text":"<p>\u2705 Backend:</p> <ul> <li>\u00cdndices en tablas principales</li> <li>Paginaci\u00f3n en listados grandes</li> <li>Cach\u00e9 de configuraciones (cache.js)</li> </ul> <p>\u2705 Frontend:</p> <ul> <li>Lazy loading de m\u00f3dulos</li> <li>Service Worker (PWA)</li> <li>OnPush change detection en componentes cr\u00edticos</li> </ul>"},{"location":"fichaje_app/arquitectura/decisiones/#areas-de-mejora_1","title":"\u26a0\ufe0f \u00c1reas de Mejora","text":"<p>\u274c Pendiente:</p> <ul> <li>Implementar Redis para cach\u00e9</li> <li>Optimizar queries N+1 en Sequelize</li> <li>Comprimir respuestas HTTP (gzip)</li> <li>CDN para assets est\u00e1ticos</li> </ul>"},{"location":"fichaje_app/arquitectura/decisiones/#testing","title":"\ud83e\uddea Testing","text":"<p>[!WARNING] &gt; CR\u00cdTICO: El proyecto actualmente NO tiene tests automatizados.</p> <p>Estado actual:</p> <ul> <li>\u274c Sin tests unitarios</li> <li>\u274c Sin tests de integraci\u00f3n</li> <li>\u274c Sin tests E2E</li> </ul> <p>Recomendaci\u00f3n urgente:</p> <ol> <li>Implementar tests unitarios para controllers cr\u00edticos</li> <li>Tests de integraci\u00f3n para flujos principales</li> <li>Tests E2E para user journeys cr\u00edticos</li> </ol> <p>Stack sugerido:</p> <ul> <li>Backend: Jest + Supertest</li> <li>Frontend: Jasmine + Karma (ya configurado)</li> </ul>"},{"location":"fichaje_app/arquitectura/decisiones/#monitoreo-y-logs","title":"\ud83d\udcca Monitoreo y Logs","text":"<p>Estado actual:</p> <ul> <li>\u2705 Morgan para logs HTTP (desarrollo)</li> <li>\u2705 Console.log para errores</li> <li>\u274c Sin sistema de logging estructurado</li> <li>\u274c Sin monitoreo de errores (Sentry, etc.)</li> </ul> <p>Recomendaci\u00f3n:</p> <ul> <li>Implementar Winston para logging estructurado</li> <li>Integrar Sentry o similar para tracking de errores</li> <li>Monitoreo de rendimiento (New Relic, DataDog)</li> </ul>"},{"location":"fichaje_app/arquitectura/decisiones/#migraciones-y-versionado","title":"\ud83d\udd04 Migraciones y Versionado","text":"<p>Base de datos:</p> <ul> <li>Sequelize CLI configurado</li> <li>Carpeta <code>migrations/</code> disponible</li> <li>\u26a0\ufe0f Pocas migraciones documentadas</li> </ul> <p>Recomendaci\u00f3n:</p> <ul> <li>Crear migraciones para todos los cambios de schema</li> <li>Documentar cambios en CHANGELOG.md</li> <li>Versionado sem\u00e1ntico (SemVer)</li> </ul>"},{"location":"fichaje_app/arquitectura/decisiones/#resumen-de-deuda-tecnica","title":"\ud83d\udcdd Resumen de Deuda T\u00e9cnica","text":"Prioridad \u00cdtem Impacto Nota \ud83d\udd34 ALTA Implementar tests Alto Urgente \ud83d\udfe1 MEDIA Migrar queries directas a Sequelize Medio Mejora mantenibilidad \ud83d\udfe1 MEDIA Implementar logging estructurado Medio Mejora debugging \ud83d\udfe2 BAJA Optimizar rendimiento Bajo No cr\u00edtico \ud83d\udfe2 BAJA Implementar rate limiting Bajo Seguridad adicional <p>[!NOTE] La integraci\u00f3n con Access NO es deuda t\u00e9cnica, es una decisi\u00f3n de negocio necesaria.</p> <p>Siguiente: Convenciones de C\u00f3digo</p>"},{"location":"fichaje_app/arquitectura/infraestructura/","title":"\ud83c\udf0d Infraestructura y Despliegue","text":"<p>Este documento detalla la topolog\u00eda de servidores, bases de datos y estrategia de despliegue del proyecto Fichaje.</p> <p>Debido a la evoluci\u00f3n hist\u00f3rica del proyecto, la infraestructura actual es compleja y opera en un estado h\u00edbrido entre modelos Single-tenant (Legacy) y Multi-tenant (Moderno).</p>"},{"location":"fichaje_app/arquitectura/infraestructura/#mapa-de-infraestructura","title":"\ud83d\uddfa\ufe0f Mapa de Infraestructura","text":""},{"location":"fichaje_app/arquitectura/infraestructura/#resumen-de-topologia","title":"Resumen de Topolog\u00eda","text":"<p>Actualmente el ecosistema se compone de:</p> <ul> <li>6 Bases de Datos SQL Server independientes.</li> <li>5 Entornos de Producci\u00f3n (Pares Backend + Frontend).</li> <li>1 Entorno de Pruebas (Local).</li> </ul>"},{"location":"fichaje_app/arquitectura/infraestructura/#bases-de-datos-sql-server","title":"Bases de Datos (SQL Server)","text":"Base de Datos Tipo Cliente / Uso Estado Descripci\u00f3n <code>appPruebas</code> \ud83d\udfe1 Dev Pruebas / Local Activo Base de datos para desarrollo local. Sin servidor de producci\u00f3n asociado. <code>appLaTorre</code> \ud83d\udfe2 Prod Uso Interno Legacy Instancia hist\u00f3rica para uso interno de la empresa. Nombre confuso: no confundir con cliente LaTorre. <code>AppFichaje</code> \ud83d\udfe2 Prod Cliente: LaTorre Legacy Instancia dedicada exclusiva para el cliente LaTorre. <code>ThrApp</code> \ud83d\udfe2 Prod Cliente: THR Legacy Instancia dedicada exclusiva para el cliente THR. <code>EzeqApp</code> \ud83d\udfe2 Prod Cliente: Ezeq Legacy Instancia dedicada exclusiva para el cliente Ezeq. <code>kong1App</code> \ud83d\udfe2 Prod Multi-tenant Moderno Instancia consolidada alojando a 8 clientes y futuros. Es la arquitectura objetivo. <p>[!NOTE] &gt; Estrategia de Migraci\u00f3n: El objetivo a largo plazo es migrar los clientes de instancias dedicadas (<code>AppFichaje</code>, <code>ThrApp</code>, <code>EzeqApp</code>) hacia entornos consolidados como <code>kong1App</code> (o un futuro <code>kong2App</code>) para reducir costos y mantenimiento.</p>"},{"location":"fichaje_app/arquitectura/infraestructura/#estrategia-de-despliegue-cicd","title":"\ud83d\ude80 Estrategia de Despliegue (CI/CD)","text":"<p>El despliegue est\u00e1 automatizado mediante GitHub Actions y se basa en una estrategia de ramas por entorno.</p>"},{"location":"fichaje_app/arquitectura/infraestructura/#repositorios","title":"Repositorios","text":"<p>El c\u00f3digo fuente se gestiona en el usuario <code>davidPayan8</code>. Existen repositorios separados para Backend y Frontend, pero comparten la misma l\u00f3gica de ramas.</p>"},{"location":"fichaje_app/arquitectura/infraestructura/#mapeo-de-ramas-a-entornos","title":"Mapeo de Ramas a Entornos","text":"<p>Cada rama en el repositorio dispara un despliegue a un servidor espec\u00edfico que conecta a una base de datos espec\u00edfica.</p> Branch (Git) Servidor Destino (Back/Front) Base de Datos Conectada Apuntes <code>main</code> Servidor LaTorre <code>AppFichaje</code> \u00a1Cuidado! <code>main</code> no es producci\u00f3n gen\u00e9rica, es espec\u00edfica para el cliente LaTorre. <code>LaTorre</code> Servidor Interno <code>appLaTorre</code> Para uso interno de la empresa. <code>THR</code> Servidor THR <code>ThrApp</code> <code>Ezeq</code> Servidor Ezeq <code>EzeqApp</code> <code>kong1</code> Servidor Kong <code>kong1App</code> Rama principal para el desarrollo de la versi\u00f3n Multi-tenant."},{"location":"fichaje_app/arquitectura/infraestructura/#diagrama-de-flujo-de-despliegue","title":"Diagrama de Flujo de Despliegue","text":"<pre><code>graph LR\n    subgraph \"GIT (davidPayan8)\"\n        B_Main[Branch: main]\n        B_LaTorre[Branch: LaTorre]\n        B_THR[Branch: THR]\n        B_Ezeq[Branch: Ezeq]\n        B_Kong[Branch: kong1]\n    end\n\n    subgraph \"CI/CD Pipeline\"\n        Action[GitHub Actions]\n    end\n\n    subgraph \"Infraestructura (5 Servidores)\"\n        S_Fichaje[SRV: LaTorre]\n        S_LaTorre[SRV: Interno]\n        S_THR[SRV: THR]\n        S_Ezeq[SRV: Ezeq]\n        S_Kong[SRV: Multi-tenant]\n    end\n\n    subgraph \"Persistencia (6 BDs)\"\n        DB_Fichaje[(AppFichaje)]\n        DB_LaTorre[(appLaTorre)]\n        DB_THR[(ThrApp)]\n        DB_Ezeq[(EzeqApp)]\n        DB_Kong[(kong1App)]\n    end\n\n    B_Main --&gt; Action --&gt; S_Fichaje --&gt; DB_Fichaje\n    B_LaTorre --&gt; Action --&gt; S_LaTorre --&gt; DB_LaTorre\n    B_THR --&gt; Action --&gt; S_THR --&gt; DB_THR\n    B_Ezeq --&gt; Action --&gt; S_Ezeq --&gt; DB_Ezeq\n    B_Kong --&gt; Action --&gt; S_Kong --&gt; DB_Kong</code></pre>"},{"location":"fichaje_app/arquitectura/infraestructura/#detalles-de-configuracion","title":"\u2699\ufe0f Detalles de Configuraci\u00f3n","text":""},{"location":"fichaje_app/arquitectura/infraestructura/#vinculacion-frontend-backend","title":"Vinculaci\u00f3n Frontend - Backend","text":"<p>Dado que hay 5 servidores de backend diferentes, cada frontend debe saber a cu\u00e1l conectar.</p> <ul> <li>Build Time: La URL de la API se \"quema\" en los archivos de entorno (<code>environment.prod.ts</code>) durante la compilaci\u00f3n o mediante sustituci\u00f3n de variables en el pipeline de CI/CD.</li> <li>Ramas diferentes: Es probable que cada rama del frontend tenga configurada la URL de su API correspondiente directamente en el c\u00f3digo o configuraci\u00f3n.</li> </ul>"},{"location":"fichaje_app/arquitectura/infraestructura/#gestion-de-servidores","title":"Gesti\u00f3n de Servidores","text":"<ul> <li>Single-tenant (Legacy): Se levanta un servidor completo (Node.js proceso + Servidor est\u00e1tico/SSR) por cada cliente grande. Esto escala mal en costes y gesti\u00f3n.</li> <li>Multi-tenant (Kong): Un solo servidor atiende a N empresas. La separaci\u00f3n de datos se hace por l\u00f3gica de aplicaci\u00f3n (<code>id_empresa</code>) en lugar de por infraestructura f\u00edsica.</li> </ul>"},{"location":"fichaje_app/arquitectura/infraestructura/#puntos-criticos-para-desarrolladores","title":"\u26a0\ufe0f Puntos Cr\u00edticos para Desarrolladores","text":""},{"location":"fichaje_app/arquitectura/infraestructura/#1-seleccion-de-rama","title":"1. Selecci\u00f3n de Rama","text":"<p>Cuando desarrolles una nueva feature, \u00bfd\u00f3nde debe ir?</p> <ul> <li>Si es core: Normalmente a <code>kong1</code> y luego cherry-pick/merge a las dem\u00e1s.</li> <li>Si es hotfix para un cliente: A su rama espec\u00edfica (<code>THR</code>, <code>Ezeq</code>, etc.).</li> </ul>"},{"location":"fichaje_app/arquitectura/infraestructura/#2-confusion-de-nombres","title":"2. Confusi\u00f3n de Nombres","text":"<ul> <li><code>appLaTorre</code> (BD) -&gt; Es para uso interno.</li> <li><code>AppFichaje</code> (BD) -&gt; Es para el cliente LaTorre.</li> <li>Rama <code>main</code> -&gt; Despliega al cliente LaTorre (no es el trunk gen\u00e9rico habitual).</li> </ul>"},{"location":"fichaje_app/arquitectura/infraestructura/#3-multi-tenancy-hibrido","title":"3. Multi-tenancy H\u00edbrido","text":"<p>Al codificar, SIEMPRE asume que est\u00e1s en entorno multi-tenant (filtra por empresa), incluso si el c\u00f3digo corre en un servidor dedicado. Esto facilita la migraci\u00f3n futura a <code>kong1App</code>.</p>"},{"location":"fichaje_app/arquitectura/overview/","title":"Vista General de la Arquitectura","text":""},{"location":"fichaje_app/arquitectura/overview/#arquitectura-del-sistema","title":"\ud83c\udfdb\ufe0f Arquitectura del Sistema","text":"<p>El proyecto Fichaje sigue una arquitectura cliente-servidor con separaci\u00f3n clara entre frontend y backend.</p> <pre><code>graph TB\n    subgraph \"Cliente\"\n        A[Angular App&lt;br/&gt;PWA]\n    end\n\n    subgraph \"Servidor\"\n        B[Express API&lt;br/&gt;REST]\n        C[Sequelize ORM]\n    end\n\n    subgraph \"Almacenamiento\"\n        D[(SQL Server&lt;br/&gt;Database)]\n        E[Azure Blob&lt;br/&gt;Storage]\n    end\n\n    subgraph \"Legacy\"\n        F[(Access DB&lt;br/&gt;\u26a0\ufe0f Paralela)]\n    end\n\n    A --&gt;|HTTP/HTTPS| B\n    B --&gt; C\n    C --&gt; D\n    B -.-&gt;|Consultas directas| F\n    B --&gt; E\n\n    style F fill:#ff9999,stroke:#ff0000,stroke-width:2px\n    style A fill:#e1f5ff\n    style B fill:#fff3e0\n    style D fill:#f3e5f5\n    style E fill:#e8f5e9</code></pre>"},{"location":"fichaje_app/arquitectura/overview/#flujo-de-datos","title":"\ud83d\udd04 Flujo de Datos","text":""},{"location":"fichaje_app/arquitectura/overview/#1-autenticacion-y-autorizacion","title":"1. Autenticaci\u00f3n y Autorizaci\u00f3n","text":"<pre><code>sequenceDiagram\n    participant U as Usuario\n    participant F as Frontend\n    participant A as API\n    participant DB as SQL Server\n\n    U-&gt;&gt;F: Login (user, password)\n    F-&gt;&gt;A: POST /auth/login\n    A-&gt;&gt;DB: Verificar credenciales\n    DB--&gt;&gt;A: Usuario + Empresa + Config\n    A--&gt;&gt;F: JWT Token + User Data\n    F-&gt;&gt;F: Guardar token (localStorage)\n    F-&gt;&gt;A: Requests con Authorization header\n    A-&gt;&gt;A: Verificar JWT (authMiddleware)\n    A--&gt;&gt;F: Respuesta autorizada</code></pre> <p>Componentes clave:</p> <ul> <li>authMiddleware.js: Verifica el token JWT en cada petici\u00f3n</li> <li>authorizeRol.js: Verifica permisos por rol (admin, superadmin, usuario)</li> <li>superadminMiddleware.js: Protege rutas exclusivas de superadmin</li> </ul>"},{"location":"fichaje_app/arquitectura/overview/#2-flujo-de-fichaje-asistencia","title":"2. Flujo de Fichaje (Asistencia)","text":"<pre><code>sequenceDiagram\n    participant U as Usuario\n    participant F as Frontend\n    participant A as API\n    participant DB as SQL Server\n\n    U-&gt;&gt;F: Click \"Fichar Entrada\"\n    F-&gt;&gt;F: Obtener geolocalizaci\u00f3n\n    F-&gt;&gt;A: POST /asistencia/fichar-entrada\n    A-&gt;&gt;DB: Verificar parte_auto (CONFIG_EMPRESA)\n\n    alt parte_auto = true\n        A-&gt;&gt;DB: Crear CONTROL_ASISTENCIAS\n        A-&gt;&gt;DB: Crear PARTES_TRABAJO (autom\u00e1tico)\n        A--&gt;&gt;F: Fichaje + Parte creados\n    else parte_auto = false\n        A-&gt;&gt;DB: Crear CONTROL_ASISTENCIAS\n        A--&gt;&gt;F: Solo fichaje creado\n    end\n\n    F-&gt;&gt;U: Confirmaci\u00f3n visual</code></pre> <p>Tablas involucradas:</p> <ul> <li><code>CONTROL_ASISTENCIAS</code>: Registro de entrada/salida</li> <li><code>PARTES_TRABAJO</code>: Partes de trabajo (si parte_auto est\u00e1 activo)</li> <li><code>CONFIG_EMPRESA</code>: Configuraci\u00f3n por empresa</li> </ul>"},{"location":"fichaje_app/arquitectura/overview/#3-gestion-de-proyectos-y-ordenes-de-trabajo","title":"3. Gesti\u00f3n de Proyectos y \u00d3rdenes de Trabajo","text":"<pre><code>graph LR\n    A[PROYECTOS] --&gt; B[ORDEN_TRABAJO]\n    B --&gt; C[PARTES_TRABAJO]\n    B --&gt; D[CABECERA&lt;br/&gt;Albar\u00e1n]\n    D --&gt; E[DETALLES_DOC&lt;br/&gt;L\u00edneas]\n    D --&gt; F[COBROS_DOC]\n    C --&gt; G[PARTES_MATERIALES]\n\n    style A fill:#e3f2fd\n    style B fill:#fff3e0\n    style C fill:#f3e5f5\n    style D fill:#e8f5e9</code></pre> <p>Relaciones:</p> <ol> <li>Un PROYECTO tiene m\u00faltiples \u00d3RDENES DE TRABAJO</li> <li>Una ORDEN DE TRABAJO tiene:</li> <li>M\u00faltiples PARTES DE TRABAJO (tiempo de empleados)</li> <li>Una CABECERA de albar\u00e1n/factura</li> <li>La CABECERA contiene:</li> <li>DETALLES_DOC (l\u00edneas de facturaci\u00f3n)</li> <li>COBROS_DOC (pagos recibidos)</li> </ol>"},{"location":"fichaje_app/arquitectura/overview/#estructura-de-modulos","title":"\ud83d\udce6 Estructura de M\u00f3dulos","text":""},{"location":"fichaje_app/arquitectura/overview/#backend-express-api","title":"Backend (Express API)","text":"<pre><code>backend-AppServicios/\n\u251c\u2500\u2500 server.js                 # Punto de entrada, configuraci\u00f3n Express\n\u251c\u2500\u2500 routes/                   # Definici\u00f3n de endpoints\n\u2502   \u251c\u2500\u2500 authRoutes.js        # /auth/*\n\u2502   \u251c\u2500\u2500 asistenciaRoutes.js  # /asistencia/*\n\u2502   \u251c\u2500\u2500 proyectosRoutes.js   # /proyectos/*\n\u2502   \u251c\u2500\u2500 parteRoutes.js       # /partes/*\n\u2502   \u251c\u2500\u2500 albaranRoutes.js     # /albaran/*\n\u2502   \u251c\u2500\u2500 notaGastoRoutes.js   # /nota-gasto/*\n\u2502   \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 controllers/              # L\u00f3gica de negocio\n\u2502   \u251c\u2500\u2500 asistenciaController.js\n\u2502   \u251c\u2500\u2500 proyectosController.js\n\u2502   \u251c\u2500\u2500 albaranController.js\n\u2502   \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 middleware/               # Middlewares\n\u2502   \u251c\u2500\u2500 authMiddleware.js    # Verificaci\u00f3n JWT\n\u2502   \u251c\u2500\u2500 authorizeRol.js      # Control de roles\n\u2502   \u2514\u2500\u2500 superadminMiddleware.js\n\u251c\u2500\u2500 Model/                    # Modelos Sequelize\n\u2502   \u251c\u2500\u2500 init-models.js       # Inicializaci\u00f3n de modelos\n\u2502   \u251c\u2500\u2500 USUARIOS.js\n\u2502   \u251c\u2500\u2500 CONTROL_ASISTENCIAS.js\n\u2502   \u251c\u2500\u2500 PROYECTOS.js\n\u2502   \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 config/\n\u2502   \u251c\u2500\u2500 dbConfig.js          # Configuraci\u00f3n Sequelize\n\u2502   \u2514\u2500\u2500 ftpConfig.js\n\u2514\u2500\u2500 utils/                    # Utilidades\n    \u2514\u2500\u2500 dateUtils.js\n</code></pre> <p>Patr\u00f3n de dise\u00f1o: MVC (Model-View-Controller)</p> <ul> <li>Routes: Definen endpoints y aplican middlewares</li> <li>Controllers: Implementan la l\u00f3gica de negocio</li> <li>Models: Representan tablas de la base de datos</li> </ul>"},{"location":"fichaje_app/arquitectura/overview/#frontend-angular","title":"Frontend (Angular)","text":"<pre><code>front-AppServicios/src/app/\n\u251c\u2500\u2500 app.routes.ts            # Configuraci\u00f3n de rutas\n\u251c\u2500\u2500 pages/                   # P\u00e1ginas principales\n\u2502   \u251c\u2500\u2500 fichar-asistencia/\n\u2502   \u251c\u2500\u2500 page-proyectos/\n\u2502   \u251c\u2500\u2500 page-ote/           # \u00d3rdenes de trabajo\n\u2502   \u251c\u2500\u2500 listado-fichaje/\n\u2502   \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 components/              # Componentes reutilizables\n\u2502   \u251c\u2500\u2500 modal-*/\n\u2502   \u251c\u2500\u2500 tabla-*/\n\u2502   \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 services/                # Servicios HTTP\n\u2502   \u251c\u2500\u2500 auth.service.ts\n\u2502   \u251c\u2500\u2500 asistencia.service.ts\n\u2502   \u251c\u2500\u2500 proyecto.service.ts\n\u2502   \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 guards/                  # Guards de navegaci\u00f3n\n\u2502   \u251c\u2500\u2500 auth.guard.ts\n\u2502   \u251c\u2500\u2500 role.guard.ts\n\u2502   \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 interceptors/            # Interceptores HTTP\n\u2502   \u251c\u2500\u2500 auth.interceptor.ts\n\u2502   \u2514\u2500\u2500 error.interceptor.ts\n\u2514\u2500\u2500 interface/               # Interfaces TypeScript\n    \u251c\u2500\u2500 usuario.ts\n    \u251c\u2500\u2500 proyecto.ts\n    \u2514\u2500\u2500 ...\n</code></pre> <p>Patr\u00f3n de dise\u00f1o: Component-based architecture</p> <ul> <li>Pages: Componentes de p\u00e1gina completa</li> <li>Components: Componentes reutilizables</li> <li>Services: Comunicaci\u00f3n con API y estado compartido</li> <li>Guards: Control de acceso a rutas</li> <li>Interceptors: Procesamiento global de peticiones HTTP</li> </ul>"},{"location":"fichaje_app/arquitectura/overview/#sistema-de-autenticacion-y-autorizacion","title":"\ud83d\udd10 Sistema de Autenticaci\u00f3n y Autorizaci\u00f3n","text":""},{"location":"fichaje_app/arquitectura/overview/#niveles-de-acceso","title":"Niveles de Acceso","text":""},{"location":"fichaje_app/arquitectura/overview/#1-superadmin","title":"1. Superadmin","text":"<p>Usuario interno para gesti\u00f3n global de empresas.</p>"},{"location":"fichaje_app/arquitectura/overview/#2-admin","title":"2. Admin","text":"<p>Administrador de empresa (Gesti\u00f3n si no hay v\u00ednculo ERP).</p>"},{"location":"fichaje_app/arquitectura/overview/#3-usuario","title":"3. Usuario","text":"<p>Usuario est\u00e1ndar del sistema.</p> <p>Categor\u00edas Laborales (Funcionalidad extra):</p> <ul> <li>T\u00e9cnico: Permisos extra en gesti\u00f3n de OTs.</li> <li>Operario/Administrativo: Funcionalidad est\u00e1ndar.</li> </ul>"},{"location":"fichaje_app/arquitectura/overview/#flujo-de-autorizacion","title":"Flujo de Autorizaci\u00f3n","text":"<pre><code>// En el backend\nrouter.post(\n  \"/ruta-protegida\",\n  authenticateToken, // 1. Verifica JWT\n  authorizeRol([\"admin\"]), // 2. Verifica rol\n  controller.metodo // 3. Ejecuta l\u00f3gica\n);\n</code></pre>"},{"location":"fichaje_app/arquitectura/overview/#multi-tenancy-multi-empresa","title":"Multi-tenancy (Multi-empresa)","text":"<p>El sistema soporta m\u00faltiples empresas:</p> <ul> <li>Cada usuario pertenece a una empresa (<code>id_empresa</code>)</li> <li>El token JWT incluye el <code>id_empresa</code></li> <li>Todas las consultas filtran por empresa autom\u00e1ticamente</li> </ul> <pre><code>// Ejemplo en controller\nconst { empresa } = req.user; // Del JWT\nconst proyectos = await db.PROYECTOS.findAll({\n  where: { id_empresa: empresa },\n});\n</code></pre>"},{"location":"fichaje_app/arquitectura/overview/#base-de-datos","title":"\ud83d\uddc4\ufe0f Base de Datos","text":""},{"location":"fichaje_app/arquitectura/overview/#esquema-principal-sql-server","title":"Esquema Principal (SQL Server)","text":"<p>Tablas principales:</p> Tabla Descripci\u00f3n <code>EMPRESA</code> Datos de empresas <code>CONFIG_EMPRESA</code> Configuraci\u00f3n por empresa <code>USUARIOS</code> Usuarios del sistema <code>CONTROL_ASISTENCIAS</code> Fichajes de entrada/salida <code>PROYECTOS</code> Proyectos <code>ORDEN_TRABAJO</code> \u00d3rdenes de trabajo <code>PARTES_TRABAJO</code> Partes de trabajo de empleados <code>CABECERA</code> Cabeceras de albaranes <code>DETALLES_DOC</code> L\u00edneas de albaranes <code>VACACIONES</code> Solicitudes de vacaciones <code>NOTIFICACIONES</code> Sistema de notificaciones"},{"location":"fichaje_app/arquitectura/overview/#orm-sequelize","title":"ORM: Sequelize","text":"<ul> <li>Versi\u00f3n: 6.37.7</li> <li>Dialecto: mssql (SQL Server)</li> <li>Timezone: UTC (+00:00)</li> <li>Generaci\u00f3n de modelos: Autom\u00e1tica con <code>sequelize-auto</code></li> </ul> <pre><code>// Ejemplo de modelo\nconst USUARIOS = sequelize.define(\n  \"USUARIOS\",\n  {\n    id: { type: DataTypes.INTEGER, primaryKey: true },\n    nombre: DataTypes.STRING,\n    id_empresa: DataTypes.INTEGER,\n    // ...\n  },\n  {\n    tableName: \"USUARIOS\",\n    timestamps: false,\n  }\n);\n</code></pre>"},{"location":"fichaje_app/arquitectura/overview/#api-rest","title":"\ud83c\udf10 API REST","text":""},{"location":"fichaje_app/arquitectura/overview/#estructura-de-urls","title":"Estructura de URLs","text":"<pre><code>Base URL: http://localhost:3000\n\nAutenticaci\u00f3n:\nPOST   /auth/login\nPOST   /auth/refresh\n\nAsistencia:\nPOST   /asistencia/fichar-entrada\nPOST   /asistencia/fichar-salida\nGET    /asistencia/partes-usuario\n\nProyectos:\nGET    /proyectos\nGET    /proyectos/:id\nPOST   /proyectos\nPUT    /proyectos/:id\n\nPartes de Trabajo:\nGET    /partes\nPOST   /partes\nPUT    /partes/:id\n\nAlbaranes:\nGET    /albaran/cabecera\nPOST   /albaran/cabecera\nGET    /albaran/detalles\nPOST   /albaran/detalles\n</code></pre>"},{"location":"fichaje_app/arquitectura/overview/#formato-de-respuestas","title":"Formato de Respuestas","text":"<p>\u00c9xito:</p> <pre><code>{\n  \"data\": { ... },\n  \"message\": \"Operaci\u00f3n exitosa\"\n}\n</code></pre> <p>Error:</p> <pre><code>{\n  \"error\": \"Mensaje de error\",\n  \"details\": \"Detalles adicionales\"\n}\n</code></pre> <p>Paginaci\u00f3n:</p> <pre><code>{\n  \"data\": [...],\n  \"pagination\": {\n    \"page\": 1,\n    \"limit\": 20,\n    \"total\": 100,\n    \"totalPages\": 5\n  }\n}\n</code></pre>"},{"location":"fichaje_app/arquitectura/overview/#progressive-web-app-pwa","title":"\ud83d\udcf1 Progressive Web App (PWA)","text":"<p>El frontend est\u00e1 configurado como PWA:</p> <ul> <li>Service Worker: Habilitado (<code>@angular/service-worker</code>)</li> <li>Manifest: <code>ngsw-config.json</code></li> <li>Capacidades offline: Cach\u00e9 de assets est\u00e1ticos</li> </ul>"},{"location":"fichaje_app/arquitectura/overview/#manejo-de-fechas","title":"\ud83d\udd04 Manejo de Fechas","text":"<p>[!IMPORTANT] &gt; TRANSICI\u00d3N EN CURSO: El proyecto est\u00e1 migrando de <code>js-joda</code> a <code>date-fns</code>. C\u00f3digo nuevo debe usar <code>date-fns</code>.</p> <p>Librer\u00eda actual (c\u00f3digo nuevo): date-fns + date-fns-tz</p> <pre><code>// Backend\nconst { format, parseISO } = require(\"date-fns\");\nconst { utcToZonedTime } = require(\"date-fns-tz\");\nconst fecha = utcToZonedTime(new Date(), \"Europe/Madrid\");\n</code></pre> <pre><code>// Frontend\nimport { format, parseISO } from \"date-fns\";\nimport { utcToZonedTime } from \"date-fns-tz\";\nconst fecha = utcToZonedTime(new Date(), \"Europe/Madrid\");\n</code></pre> <p>C\u00f3digo legacy: A\u00fan encontrar\u00e1s <code>js-joda</code> en partes antiguas del c\u00f3digo.</p> <p>Zona horaria: Europa/Madrid (configurada en ambos lados)</p>"},{"location":"fichaje_app/arquitectura/overview/#almacenamiento-de-archivos","title":"\ud83d\udcca Almacenamiento de Archivos","text":""},{"location":"fichaje_app/arquitectura/overview/#azure-blob-storage","title":"Azure Blob Storage","text":"<p>Usado para almacenar:</p> <ul> <li>Tickets de notas de gasto</li> <li>Documentos adjuntos</li> <li>Exportaciones de Excel</li> </ul> <p>Configuraci\u00f3n (variables de entorno):</p> <ul> <li><code>AZURE_STORAGE_CONNECTION_STRING</code></li> <li><code>AZURE_STORAGE_CONTAINER_NAME</code></li> </ul>"},{"location":"fichaje_app/arquitectura/overview/#infraestructura-y-despliegue","title":"\ud83c\udf0d Infraestructura y Despliegue","text":"<p>[!IMPORTANT] La infraestructura es compleja debido a la coexistencia de sistemas legacy y modernos. Consulta el documento dedicado: \ud83d\udcc4 Infraestructura y Despliegue</p>"},{"location":"fichaje_app/arquitectura/overview/#resumen-rapido","title":"Resumen R\u00e1pido","text":"<ul> <li>6 Bases de Datos: Mezcla de dedicadas y multi-tenant.</li> <li>5 Entornos de Producci\u00f3n: Gestionados por ramas de Git (<code>main</code>, <code>LaTorre</code>, <code>kong1</code>, etc.).</li> <li>Modelo H\u00edbrido: Transici\u00f3n de \"Servidor por Cliente\" a \"Multi-tenant\".</li> </ul> <p>Ver detalle completo en Infraestructura.</p> <p>Siguiente: Decisiones Arquitect\u00f3nicas</p>"},{"location":"fichaje_app/guias/convenciones/","title":"Convenciones de C\u00f3digo","text":"<p>Este documento describe las convenciones y est\u00e1ndares de c\u00f3digo que se siguen en el proyecto.</p>"},{"location":"fichaje_app/guias/convenciones/#estructura-de-archivos","title":"\ud83d\udcc2 Estructura de Archivos","text":""},{"location":"fichaje_app/guias/convenciones/#backend-nodejsexpress","title":"Backend (Node.js/Express)","text":""},{"location":"fichaje_app/guias/convenciones/#nomenclatura","title":"Nomenclatura","text":"<ul> <li>Archivos: <code>camelCase.js</code> (ej: <code>asistenciaController.js</code>)</li> <li>Carpetas: <code>lowercase</code> (ej: <code>controllers</code>, <code>routes</code>)</li> <li>Modelos Sequelize: <code>UPPERCASE.js</code> (ej: <code>USUARIOS.js</code>, <code>PROYECTOS.js</code>)</li> </ul>"},{"location":"fichaje_app/guias/convenciones/#organizacion","title":"Organizaci\u00f3n","text":"<pre><code>backend-AppServicios/\n\u251c\u2500\u2500 controllers/\n\u2502   \u2514\u2500\u2500 [modulo]Controller.js    # Un controller por m\u00f3dulo\n\u251c\u2500\u2500 routes/\n\u2502   \u2514\u2500\u2500 [modulo]Routes.js        # Un archivo de rutas por m\u00f3dulo\n\u251c\u2500\u2500 Model/\n\u2502   \u251c\u2500\u2500 init-models.js           # Inicializaci\u00f3n\n\u2502   \u2514\u2500\u2500 [TABLA].js               # Un archivo por tabla\n\u251c\u2500\u2500 middleware/\n\u2502   \u2514\u2500\u2500 [nombre]Middleware.js\n\u2514\u2500\u2500 utils/\n    \u2514\u2500\u2500 [utilidad].js\n</code></pre>"},{"location":"fichaje_app/guias/convenciones/#frontend-angular","title":"Frontend (Angular)","text":""},{"location":"fichaje_app/guias/convenciones/#nomenclatura-angular","title":"Nomenclatura Angular","text":"<ul> <li>Componentes: <code>nombre-componente.component.ts</code></li> <li>Servicios: <code>nombre.service.ts</code></li> <li>Guards: <code>nombre.guard.ts</code></li> <li>Interfaces: <code>nombre.ts</code></li> <li>Pipes: <code>nombre.pipe.ts</code></li> </ul>"},{"location":"fichaje_app/guias/convenciones/#organizacion_1","title":"Organizaci\u00f3n","text":"<pre><code>src/app/\n\u251c\u2500\u2500 pages/\n\u2502   \u2514\u2500\u2500 nombre-pagina/\n\u2502       \u251c\u2500\u2500 nombre-pagina.component.ts\n\u2502       \u251c\u2500\u2500 nombre-pagina.component.html\n\u2502       \u251c\u2500\u2500 nombre-pagina.component.css\n\u2502       \u2514\u2500\u2500 nombre-pagina.component.spec.ts\n\u251c\u2500\u2500 components/\n\u2502   \u2514\u2500\u2500 nombre-componente/\n\u2502       \u2514\u2500\u2500 [misma estructura]\n\u251c\u2500\u2500 services/\n\u2502   \u2514\u2500\u2500 nombre/\n\u2502       \u251c\u2500\u2500 nombre.service.ts\n\u2502       \u2514\u2500\u2500 nombre.service.spec.ts\n\u2514\u2500\u2500 interface/\n    \u2514\u2500\u2500 nombre.ts\n</code></pre>"},{"location":"fichaje_app/guias/convenciones/#estilo-de-codigo","title":"\ud83c\udfa8 Estilo de C\u00f3digo","text":""},{"location":"fichaje_app/guias/convenciones/#backend-javascript","title":"Backend (JavaScript)","text":""},{"location":"fichaje_app/guias/convenciones/#formato-general","title":"Formato General","text":"<pre><code>// \u2705 BIEN\nconst funcionEjemplo = async (req, res) =&gt; {\n  try {\n    const { empresa } = req.user;\n    const { parametro } = req.body;\n\n    // L\u00f3gica de negocio\n    const resultado = await db.TABLA.findAll({\n      where: { id_empresa: empresa },\n    });\n\n    res.status(200).json(resultado);\n  } catch (error) {\n    console.error(\"Error en funcionEjemplo:\", error.message);\n    res.status(500).json({ message: \"Error del servidor\" });\n  }\n};\n</code></pre>"},{"location":"fichaje_app/guias/convenciones/#convenciones","title":"Convenciones","text":"<ul> <li>\u2705 Usar <code>const</code> y <code>let</code>, nunca <code>var</code></li> <li>\u2705 Arrow functions para callbacks</li> <li>\u2705 Async/await en lugar de promises con <code>.then()</code></li> <li>\u2705 Destructuring de objetos</li> <li>\u2705 Template literals para strings</li> </ul>"},{"location":"fichaje_app/guias/convenciones/#manejo-de-errores","title":"Manejo de Errores","text":"<pre><code>// \u2705 BIEN - Try/catch en todos los controllers\nconst controller = async (req, res) =&gt; {\n  try {\n    // L\u00f3gica\n  } catch (error) {\n    console.error(\"Contexto del error:\", error.message);\n    res.status(500).json({ message: \"Error del servidor\" });\n  }\n};\n\n// \u274c MAL - Sin manejo de errores\nconst controller = async (req, res) =&gt; {\n  const data = await db.TABLA.findAll(); // Puede fallar\n  res.json(data);\n};\n</code></pre>"},{"location":"fichaje_app/guias/convenciones/#frontend-typescript","title":"Frontend (TypeScript)","text":""},{"location":"fichaje_app/guias/convenciones/#formato-general_1","title":"Formato General","text":"<pre><code>// \u2705 BIEN\nexport class MiComponente implements OnInit {\n  // Propiedades p\u00fablicas primero\n  titulo: string = \"\";\n  datos: MiInterface[] = [];\n\n  // Propiedades privadas despu\u00e9s\n  private subscription?: Subscription;\n\n  constructor(private miService: MiService, private router: Router) {}\n\n  ngOnInit(): void {\n    this.cargarDatos();\n  }\n\n  cargarDatos(): void {\n    this.miService.obtenerDatos().subscribe({\n      next: (datos) =&gt; (this.datos = datos),\n      error: (error) =&gt; console.error(\"Error:\", error),\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.subscription?.unsubscribe();\n  }\n}\n</code></pre>"},{"location":"fichaje_app/guias/convenciones/#convenciones-typescript","title":"Convenciones TypeScript","text":"<ul> <li>\u2705 Tipado expl\u00edcito en par\u00e1metros y retornos</li> <li>\u2705 Interfaces para estructuras de datos</li> <li>\u2705 Enums para valores constantes</li> <li>\u2705 Readonly para propiedades inmutables</li> <li>\u2705 Optional chaining (<code>?.</code>) y nullish coalescing (<code>??</code>)</li> </ul>"},{"location":"fichaje_app/guias/convenciones/#servicios","title":"Servicios","text":"<pre><code>// \u2705 BIEN\n@Injectable({ providedIn: \"root\" })\nexport class MiService {\n  private apiUrl = `${environment.apiUrl}/mi-recurso`;\n\n  constructor(private http: HttpClient) {}\n\n  obtenerTodos(): Observable&lt;MiInterface[]&gt; {\n    return this.http.get&lt;MiInterface[]&gt;(this.apiUrl);\n  }\n\n  obtenerPorId(id: number): Observable&lt;MiInterface&gt; {\n    return this.http.get&lt;MiInterface&gt;(`${this.apiUrl}/${id}`);\n  }\n\n  crear(datos: Partial&lt;MiInterface&gt;): Observable&lt;MiInterface&gt; {\n    return this.http.post&lt;MiInterface&gt;(this.apiUrl, datos);\n  }\n}\n</code></pre>"},{"location":"fichaje_app/guias/convenciones/#base-de-datos","title":"\ud83d\uddc4\ufe0f Base de Datos","text":""},{"location":"fichaje_app/guias/convenciones/#modelos-sequelize","title":"Modelos Sequelize","text":""},{"location":"fichaje_app/guias/convenciones/#convenciones_1","title":"Convenciones","text":"<ul> <li>Nombres de tabla: <code>UPPERCASE</code> (ej: <code>USUARIOS</code>, <code>PROYECTOS</code>)</li> <li>Nombres de columna: <code>snake_case</code> (ej: <code>id_empresa</code>, <code>fecha_creacion</code>)</li> <li>Primary key: siempre <code>id</code></li> <li>Foreign keys: <code>[tabla]_id</code> (ej: <code>usuario_id</code>, <code>proyecto_id</code>)</li> </ul>"},{"location":"fichaje_app/guias/convenciones/#ejemplo-de-modelo","title":"Ejemplo de modelo","text":"<pre><code>module.exports = function (sequelize, DataTypes) {\n  return sequelize.define(\n    \"USUARIOS\",\n    {\n      id: {\n        autoIncrement: true,\n        type: DataTypes.INTEGER,\n        allowNull: false,\n        primaryKey: true,\n      },\n      nombre: {\n        type: DataTypes.STRING(100),\n        allowNull: false,\n      },\n      id_empresa: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n        references: {\n          model: \"EMPRESA\",\n          key: \"id\",\n        },\n      },\n      fecha_creacion: {\n        type: DataTypes.DATE,\n        allowNull: false,\n        defaultValue: DataTypes.NOW,\n      },\n    },\n    {\n      sequelize,\n      tableName: \"USUARIOS\",\n      timestamps: false, // Deshabilitado (usamos fecha_creacion manual)\n      indexes: [\n        {\n          name: \"PRIMARY\",\n          unique: true,\n          using: \"BTREE\",\n          fields: [{ name: \"id\" }],\n        },\n        {\n          name: \"idx_empresa\",\n          using: \"BTREE\",\n          fields: [{ name: \"id_empresa\" }],\n        },\n      ],\n    }\n  );\n};\n</code></pre>"},{"location":"fichaje_app/guias/convenciones/#queries","title":"Queries","text":""},{"location":"fichaje_app/guias/convenciones/#convenciones_2","title":"Convenciones","text":"<pre><code>// \u2705 BIEN - Usar Sequelize\nconst usuarios = await db.USUARIOS.findAll({\n  where: {\n    id_empresa: empresa,\n    activo: true,\n  },\n  attributes: [\"id\", \"nombre\", \"email\"],\n  include: [\n    {\n      model: db.EMPRESA,\n      as: \"empresa\",\n      attributes: [\"nombre\"],\n    },\n  ],\n  order: [[\"nombre\", \"ASC\"]],\n  limit: 20,\n  offset: 0,\n});\n\n// \u274c EVITAR - Queries SQL directas\nconst result = await sequelize.query(\n  \"SELECT * FROM USUARIOS WHERE id_empresa = ?\",\n  { replacements: [empresa] }\n);\n</code></pre>"},{"location":"fichaje_app/guias/convenciones/#seguridad","title":"\ud83d\udd10 Seguridad","text":""},{"location":"fichaje_app/guias/convenciones/#autenticacion","title":"Autenticaci\u00f3n","text":""},{"location":"fichaje_app/guias/convenciones/#en-routes","title":"En Routes","text":"<pre><code>const express = require(\"express\");\nconst router = express.Router();\nconst authenticateToken = require(\"../middleware/authMiddleware\");\nconst authorizeRol = require(\"../middleware/authorizeRol\");\nconst controller = require(\"../controllers/miController\");\n\n// Ruta p\u00fablica\nrouter.post(\"/login\", controller.login);\n\n// Ruta protegida (solo autenticado)\nrouter.get(\"/datos\", authenticateToken, controller.obtenerDatos);\n\n// Ruta protegida por rol\nrouter.post(\n  \"/admin\",\n  authenticateToken,\n  authorizeRol([\"admin\"]),\n  controller.funcionAdmin\n);\n\nmodule.exports = router;\n</code></pre>"},{"location":"fichaje_app/guias/convenciones/#validacion-de-entrada","title":"Validaci\u00f3n de Entrada","text":""},{"location":"fichaje_app/guias/convenciones/#en-controllers","title":"En Controllers","text":"<pre><code>// \u2705 BIEN - Validar entrada\nconst crearUsuario = async (req, res) =&gt; {\n  try {\n    const { nombre, email, password } = req.body;\n\n    // Validaci\u00f3n\n    if (!nombre || !email || !password) {\n      return res.status(400).json({\n        message: \"Nombre, email y password son obligatorios\",\n      });\n    }\n\n    if (password.length &lt; 8) {\n      return res.status(400).json({\n        message: \"Password debe tener al menos 8 caracteres\",\n      });\n    }\n\n    // L\u00f3gica de creaci\u00f3n\n    const usuario = await db.USUARIOS.create({ nombre, email, password });\n    res.status(201).json(usuario);\n  } catch (error) {\n    console.error(\"Error al crear usuario:\", error.message);\n    res.status(500).json({ message: \"Error del servidor\" });\n  }\n};\n</code></pre>"},{"location":"fichaje_app/guias/convenciones/#manejo-de-fechas","title":"\ud83d\udcc5 Manejo de Fechas","text":"<p>[!IMPORTANT] El proyecto est\u00e1 en transici\u00f3n de js-joda a date-fns. Usa <code>date-fns</code> para c\u00f3digo nuevo.</p>"},{"location":"fichaje_app/guias/convenciones/#codigo-nuevo-recomendado-date-fns","title":"C\u00f3digo Nuevo (Recomendado: date-fns)","text":"<pre><code>// Backend\nconst { format, parseISO, addDays } = require(\"date-fns\");\nconst { utcToZonedTime, zonedTimeToUtc } = require(\"date-fns-tz\");\n\n// Obtener fecha actual en zona horaria\nconst timezone = \"Europe/Madrid\";\nconst ahora = utcToZonedTime(new Date(), timezone);\n\n// Formatear fecha\nconst fechaFormateada = format(ahora, \"dd/MM/yyyy HH:mm\");\n\n// Parsear fecha\nconst fecha = parseISO(\"2025-12-30T10:30:00\");\n</code></pre> <pre><code>// Frontend\nimport { format, parseISO, addDays } from \"date-fns\";\nimport { utcToZonedTime, zonedTimeToUtc } from \"date-fns-tz\";\nimport { es } from \"date-fns/locale\";\n\n// Mismo uso que en backend\nconst ahora = utcToZonedTime(new Date(), \"Europe/Madrid\");\n\n// Con locale espa\u00f1ol\nconst fechaFormateada = format(ahora, \"dd/MM/yyyy HH:mm\", { locale: es });\n</code></pre>"},{"location":"fichaje_app/guias/convenciones/#codigo-legacy-js-joda","title":"C\u00f3digo Legacy (js-joda)","text":"<p>Si encuentras c\u00f3digo antiguo con <code>js-joda</code>, puedes mantenerlo o migrarlo:</p> <pre><code>// C\u00f3digo antiguo - a\u00fan funcional\nimport { LocalDateTime, ZoneId } from \"@js-joda/core\";\nconst ahora = LocalDateTime.now(ZoneId.of(\"Europe/Madrid\"));\n</code></pre>"},{"location":"fichaje_app/guias/convenciones/#patrones-comunes","title":"\ud83c\udfaf Patrones Comunes","text":""},{"location":"fichaje_app/guias/convenciones/#controller-pattern-backend","title":"Controller Pattern (Backend)","text":"<pre><code>// Estructura est\u00e1ndar de un controller\nconst db = require(\"../Model\");\nconst { Op } = require(\"sequelize\");\n\nconst obtenerTodos = async (req, res) =&gt; {\n  try {\n    const { empresa } = req.user;\n    const { page = 1, limit = 20 } = req.query;\n\n    const offset = (page - 1) * limit;\n\n    const { count, rows } = await db.TABLA.findAndCountAll({\n      where: { id_empresa: empresa },\n      limit: parseInt(limit),\n      offset: parseInt(offset),\n      order: [[\"fecha_creacion\", \"DESC\"]],\n    });\n\n    res.status(200).json({\n      data: rows,\n      pagination: {\n        total: count,\n        page: parseInt(page),\n        limit: parseInt(limit),\n        totalPages: Math.ceil(count / limit),\n      },\n    });\n  } catch (error) {\n    console.error(\"Error en obtenerTodos:\", error.message);\n    res.status(500).json({ message: \"Error del servidor\" });\n  }\n};\n\nconst obtenerPorId = async (req, res) =&gt; {\n  try {\n    const { empresa } = req.user;\n    const { id } = req.params;\n\n    const registro = await db.TABLA.findOne({\n      where: {\n        id: id,\n        id_empresa: empresa,\n      },\n    });\n\n    if (!registro) {\n      return res.status(404).json({ message: \"No encontrado\" });\n    }\n\n    res.status(200).json(registro);\n  } catch (error) {\n    console.error(\"Error en obtenerPorId:\", error.message);\n    res.status(500).json({ message: \"Error del servidor\" });\n  }\n};\n\nconst crear = async (req, res) =&gt; {\n  try {\n    const { empresa } = req.user;\n    const datos = req.body;\n\n    const nuevo = await db.TABLA.create({\n      ...datos,\n      id_empresa: empresa,\n    });\n\n    res.status(201).json(nuevo);\n  } catch (error) {\n    console.error(\"Error en crear:\", error.message);\n    res.status(500).json({ message: \"Error del servidor\" });\n  }\n};\n\nconst actualizar = async (req, res) =&gt; {\n  try {\n    const { empresa } = req.user;\n    const { id } = req.params;\n    const datos = req.body;\n\n    const [updated] = await db.TABLA.update(datos, {\n      where: {\n        id: id,\n        id_empresa: empresa,\n      },\n    });\n\n    if (updated === 0) {\n      return res.status(404).json({ message: \"No encontrado\" });\n    }\n\n    res.status(200).json({ message: \"Actualizado correctamente\" });\n  } catch (error) {\n    console.error(\"Error en actualizar:\", error.message);\n    res.status(500).json({ message: \"Error del servidor\" });\n  }\n};\n\nconst eliminar = async (req, res) =&gt; {\n  try {\n    const { empresa } = req.user;\n    const { id } = req.params;\n\n    const deleted = await db.TABLA.destroy({\n      where: {\n        id: id,\n        id_empresa: empresa,\n      },\n    });\n\n    if (deleted === 0) {\n      return res.status(404).json({ message: \"No encontrado\" });\n    }\n\n    res.status(200).json({ message: \"Eliminado correctamente\" });\n  } catch (error) {\n    console.error(\"Error en eliminar:\", error.message);\n    res.status(500).json({ message: \"Error del servidor\" });\n  }\n};\n\nmodule.exports = {\n  obtenerTodos,\n  obtenerPorId,\n  crear,\n  actualizar,\n  eliminar,\n};\n</code></pre>"},{"location":"fichaje_app/guias/convenciones/#service-pattern-frontend","title":"Service Pattern (Frontend)","text":"<pre><code>import { Injectable } from \"@angular/core\";\nimport { HttpClient, HttpParams } from \"@angular/common/http\";\nimport { Observable } from \"rxjs\";\nimport { environment } from \"../../environments/environment\";\nimport { MiInterface } from \"../interface/mi-interface\";\n\n@Injectable({\n  providedIn: \"root\",\n})\nexport class MiService {\n  private apiUrl = `${environment.apiUrl}/mi-recurso`;\n\n  constructor(private http: HttpClient) {}\n\n  obtenerTodos(page: number = 1, limit: number = 20): Observable&lt;any&gt; {\n    const params = new HttpParams()\n      .set(\"page\", page.toString())\n      .set(\"limit\", limit.toString());\n\n    return this.http.get&lt;any&gt;(this.apiUrl, { params });\n  }\n\n  obtenerPorId(id: number): Observable&lt;MiInterface&gt; {\n    return this.http.get&lt;MiInterface&gt;(`${this.apiUrl}/${id}`);\n  }\n\n  crear(datos: Partial&lt;MiInterface&gt;): Observable&lt;MiInterface&gt; {\n    return this.http.post&lt;MiInterface&gt;(this.apiUrl, datos);\n  }\n\n  actualizar(id: number, datos: Partial&lt;MiInterface&gt;): Observable&lt;any&gt; {\n    return this.http.put&lt;any&gt;(`${this.apiUrl}/${id}`, datos);\n  }\n\n  eliminar(id: number): Observable&lt;any&gt; {\n    return this.http.delete&lt;any&gt;(`${this.apiUrl}/${id}`);\n  }\n}\n</code></pre>"},{"location":"fichaje_app/guias/convenciones/#comentarios-y-documentacion","title":"\ud83d\udcdd Comentarios y Documentaci\u00f3n","text":""},{"location":"fichaje_app/guias/convenciones/#comentarios-inline","title":"Comentarios Inline","text":"<pre><code>// \u2705 BIEN - Comentarios \u00fatiles\n// Verificar si el usuario tiene parte_auto habilitado\nconst parteAuto = await checkParteAuto(empresa);\n\n// \u274c MAL - Comentarios obvios\n// Crear usuario\nconst usuario = await db.USUARIOS.create(datos);\n</code></pre>"},{"location":"fichaje_app/guias/convenciones/#jsdoc-para-funciones-complejas","title":"JSDoc para funciones complejas","text":"<pre><code>/**\n * Crea un parte de trabajo autom\u00e1ticamente al fichar entrada\n * @param {number} usuarioId - ID del usuario\n * @param {number} proyectoId - ID del proyecto\n * @param {string} fecha - Fecha en formato ISO\n * @returns {Promise&lt;Object&gt;} Parte de trabajo creado\n */\nconst crearParteAutomatico = async (usuarioId, proyectoId, fecha) =&gt; {\n  // Implementaci\u00f3n\n};\n</code></pre>"},{"location":"fichaje_app/guias/convenciones/#anti-patrones-a-evitar","title":"\ud83d\udeab Anti-patrones a Evitar","text":""},{"location":"fichaje_app/guias/convenciones/#backend","title":"Backend","text":"<p>\u274c No usar callbacks anidados:</p> <pre><code>// \u274c MAL\ndb.USUARIOS.findOne({ where: { id: 1 } }, (err, user) =&gt; {\n  if (err) return res.status(500).json({ error: err });\n  db.PROYECTOS.findAll({ where: { usuario_id: user.id } }, (err, projects) =&gt; {\n    // Callback hell\n  });\n});\n\n// \u2705 BIEN\nconst user = await db.USUARIOS.findOne({ where: { id: 1 } });\nconst projects = await db.PROYECTOS.findAll({ where: { usuario_id: user.id } });\n</code></pre> <p>\u274c No modificar req.user directamente:</p> <pre><code>// \u274c MAL\nreq.user.nuevaPropiedad = \"valor\";\n\n// \u2705 BIEN\nconst datosExtendidos = { ...req.user, nuevaPropiedad: \"valor\" };\n</code></pre>"},{"location":"fichaje_app/guias/convenciones/#frontend","title":"Frontend","text":"<p>\u274c No suscribirse sin desuscribirse:</p> <pre><code>// \u274c MAL\nngOnInit() {\n  this.miService.obtenerDatos().subscribe(datos =&gt; {\n    this.datos = datos;\n  });\n  // Memory leak!\n}\n\n// \u2705 BIEN\nprivate subscription?: Subscription;\n\nngOnInit() {\n  this.subscription = this.miService.obtenerDatos().subscribe(datos =&gt; {\n    this.datos = datos;\n  });\n}\n\nngOnDestroy() {\n  this.subscription?.unsubscribe();\n}\n</code></pre> <p>\u274c No manipular DOM directamente:</p> <pre><code>// \u274c MAL\ndocument.getElementById(\"miElemento\").innerHTML = \"Nuevo texto\";\n\n// \u2705 BIEN - Usar data binding\n&lt;div&gt;{{ miTexto }}&lt;/div&gt;;\n</code></pre>"},{"location":"fichaje_app/guias/convenciones/#herramientas-de-desarrollo","title":"\ud83d\udd27 Herramientas de Desarrollo","text":"<p>Recomendadas:</p> <ul> <li>Editor: VS Code</li> <li>Extensiones VS Code:</li> <li>ESLint</li> <li>Prettier</li> <li>Angular Language Service</li> <li>SQL Server (mssql)</li> </ul> <p>Configuraci\u00f3n Prettier (crear <code>.prettierrc</code>):</p> <pre><code>{\n  \"semi\": true,\n  \"trailingComma\": \"es5\",\n  \"singleQuote\": false,\n  \"printWidth\": 100,\n  \"tabWidth\": 2\n}\n</code></pre> <p>Siguiente: Introducci\u00f3n para Nuevos Desarrolladores</p>"},{"location":"fichaje_app/onboarding/entorno/","title":"Configuraci\u00f3n del Entorno de Desarrollo","text":"<p>Esta gu\u00eda te ayudar\u00e1 a configurar tu entorno local para desarrollar en el proyecto Fichaje.</p>"},{"location":"fichaje_app/onboarding/entorno/#requisitos-previos","title":"\ud83d\udccb Requisitos Previos","text":""},{"location":"fichaje_app/onboarding/entorno/#software-necesario","title":"Software Necesario","text":"Software Versi\u00f3n M\u00ednima Notas Node.js 18.x LTS recomendado npm 9.x Incluido con Node.js SQL Server 2019+ Express Edition es suficiente Git 2.x Para control de versiones VS Code Latest Editor recomendado"},{"location":"fichaje_app/onboarding/entorno/#cuentas-y-accesos","title":"Cuentas y Accesos","text":"<ul> <li>[ ] Acceso al repositorio Git</li> <li>[ ] Credenciales de base de datos SQL Server</li> <li>[ ] Credenciales de Azure Blob Storage (para desarrollo)</li> <li>[ ] VPN/Acceso a red interna (si aplica)</li> </ul>"},{"location":"fichaje_app/onboarding/entorno/#instalacion-paso-a-paso","title":"\ud83d\udd27 Instalaci\u00f3n Paso a Paso","text":""},{"location":"fichaje_app/onboarding/entorno/#1-clonar-el-repositorio","title":"1. Clonar el Repositorio","text":"<pre><code>git clone https://github.com/tu-organizacion/fichaje.git\ncd fichaje\n</code></pre>"},{"location":"fichaje_app/onboarding/entorno/#2-configurar-backend","title":"2. Configurar Backend","text":""},{"location":"fichaje_app/onboarding/entorno/#21-instalar-dependencias","title":"2.1. Instalar Dependencias","text":"<pre><code>cd backend-AppServicios\nnpm install\n</code></pre>"},{"location":"fichaje_app/onboarding/entorno/#22-configurar-variables-de-entorno","title":"2.2. Configurar Variables de Entorno","text":"<p>Crear archivo <code>.env</code> en la ra\u00edz de <code>backend-AppServicios</code>:</p> <pre><code># .env\n# ============================================\n# CONFIGURACI\u00d3N DE BASE DE DATOS\n# ============================================\nDB_SERVER=localhost\nDB_NAME=nombre_base_datos\nDB_USER=tu_usuario\nDB_PASSWORD=tu_password\n\n# ============================================\n# CONFIGURACI\u00d3N DE SERVIDOR\n# ============================================\nPORT=3000\n# No se usa BASE_API_URL con /v1\n\n# ============================================\n# JWT (AUTENTICACI\u00d3N)\n# ============================================\nJWT_SECRET=tu_secret_key_muy_segura_aqui\nJWT_EXPIRES_IN=24h\n\n# ============================================\n# AZURE BLOB STORAGE\n# ============================================\nAZURE_STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=...\nAZURE_STORAGE_CONTAINER_NAME=fichaje-dev\n\n# ============================================\n# FTP (OPCIONAL)\n# ============================================\nFTP_HOST=ftp.ejemplo.com\nFTP_USER=usuario_ftp\nFTP_PASSWORD=password_ftp\nFTP_PORT=21\n\n# ============================================\n# EMAIL (OPCIONAL)\n# ============================================\nSMTP_HOST=smtp.gmail.com\nSMTP_PORT=587\nSMTP_USER=tu_email@gmail.com\nSMTP_PASSWORD=tu_password_app\n</code></pre> <p>[!IMPORTANT] &gt; Nunca subas el archivo <code>.env</code> al repositorio. Ya est\u00e1 incluido en <code>.gitignore</code>.</p>"},{"location":"fichaje_app/onboarding/entorno/#23-configurar-base-de-datos","title":"2.3. Configurar Base de Datos","text":"<p>Opci\u00f3n A: Usar base de datos existente</p> <p>Solicita al equipo:</p> <ul> <li>Servidor SQL Server</li> <li>Nombre de base de datos</li> <li>Credenciales de acceso</li> </ul> <p>Opci\u00f3n B: Crear base de datos local</p> <pre><code>-- En SQL Server Management Studio (SSMS)\nCREATE DATABASE FichajeDB;\nGO\n\n-- Ejecutar scripts de creaci\u00f3n de tablas\n-- (Solicitar scripts al equipo)\n</code></pre>"},{"location":"fichaje_app/onboarding/entorno/#24-verificar-conexion","title":"2.4. Verificar Conexi\u00f3n","text":"<pre><code>node -e \"const {sequelize} = require('./config/dbConfig'); sequelize.authenticate().then(() =&gt; console.log('\u2705 Conexi\u00f3n exitosa')).catch(err =&gt; console.error('\u274c Error:', err));\"\n</code></pre>"},{"location":"fichaje_app/onboarding/entorno/#25-iniciar-backend","title":"2.5. Iniciar Backend","text":"<pre><code>npm start\n</code></pre> <p>Deber\u00edas ver:</p> <pre><code>Servidor Node.js corriendo en puerto 3000\n</code></pre>"},{"location":"fichaje_app/onboarding/entorno/#3-configurar-frontend","title":"3. Configurar Frontend","text":""},{"location":"fichaje_app/onboarding/entorno/#31-instalar-dependencias","title":"3.1. Instalar Dependencias","text":"<pre><code>cd ../front-AppServicios\nnpm install\n</code></pre> <p>[!NOTE] La instalaci\u00f3n puede tardar varios minutos debido al tama\u00f1o de Angular y sus dependencias.</p>"},{"location":"fichaje_app/onboarding/entorno/#32-configurar-variables-de-entorno","title":"3.2. Configurar Variables de Entorno","text":"<p>Crear archivo <code>.env</code> en la ra\u00edz de <code>front-AppServicios</code>:</p> <pre><code># .env\nAPI_URL=http://localhost:3000\n</code></pre> <p>Verificar configuraci\u00f3n en <code>src/environments/environment.ts</code>:</p> <pre><code>export const environment = {\n  production: false,\n  apiUrl: \"http://localhost:3000\",\n};\n</code></pre>"},{"location":"fichaje_app/onboarding/entorno/#33-iniciar-frontend","title":"3.3. Iniciar Frontend","text":"<pre><code>npm start\n# o\nng serve\n</code></pre> <p>Deber\u00edas ver:</p> <pre><code>** Angular Live Development Server is listening on localhost:4200 **\n\u2714 Compiled successfully.\n</code></pre> <p>Abre tu navegador en <code>http://localhost:4200</code></p>"},{"location":"fichaje_app/onboarding/entorno/#detalles-tecnicos-de-base-de-datos","title":"\ud83d\uddc4\ufe0f Detalles T\u00e9cnicos de Base de Datos","text":""},{"location":"fichaje_app/onboarding/entorno/#estructura-de-instancia-sql-server","title":"Estructura de Instancia SQL Server","text":"<pre><code>SQL Server (KONGSERVER)\n\u2514\u2500\u2500 FichajeDB\n    \u251c\u2500\u2500 Tablas\n    \u2502   \u251c\u2500\u2500 USUARIOS\n    \u2502   \u251c\u2500\u2500 EMPRESA\n    \u2502   \u251c\u2500\u2500 CONTROL_ASISTENCIAS\n    \u2502   \u251c\u2500\u2500 PROYECTOS\n    \u2502   \u2514\u2500\u2500 ... (ver Model/init-models.js)\n    \u2514\u2500\u2500 Stored Procedures (si aplica)\n</code></pre>"},{"location":"fichaje_app/onboarding/entorno/#configuracion-de-sequelize","title":"Configuraci\u00f3n de Sequelize","text":"<p>El proyecto usa Sequelize como ORM. Configuraci\u00f3n en <code>config/dbConfig.js</code>:</p> <pre><code>const sequelize = new Sequelize(\n  process.env.DB_NAME,\n  process.env.DB_USER,\n  process.env.DB_PASSWORD,\n  {\n    host: process.env.DB_SERVER,\n    dialect: \"mssql\",\n    timezone: \"+00:00\", // UTC\n    dialectOptions: {\n      options: {\n        instanceName: \"KONGSERVER\", // Nombre de instancia SQL Server\n        encrypt: false,\n        enableArithAbort: true,\n        trustServerCertificate: true,\n      },\n    },\n    logging: false, // Cambiar a console.log para debug\n  }\n);\n</code></pre>"},{"location":"fichaje_app/onboarding/entorno/#generar-modelos-automaticamente","title":"Generar Modelos Autom\u00e1ticamente","text":"<p>Si necesitas regenerar los modelos desde la base de datos:</p> <pre><code>cd backend-AppServicios\nnode generate-models.js\n</code></pre> <p>Esto crear\u00e1/actualizar\u00e1 archivos en <code>Model/</code> bas\u00e1ndose en el schema de la BD.</p>"},{"location":"fichaje_app/onboarding/entorno/#configuracion-de-azure-blob-storage","title":"\u2601\ufe0f Configuraci\u00f3n de Azure Blob Storage","text":""},{"location":"fichaje_app/onboarding/entorno/#obtener-credenciales","title":"Obtener Credenciales","text":"<ol> <li>Acceder al portal de Azure</li> <li>Ir a Storage Account</li> <li>Copiar Connection String</li> </ol>"},{"location":"fichaje_app/onboarding/entorno/#configurar-en-env","title":"Configurar en .env","text":"<pre><code>AZURE_STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=tuaccount;AccountKey=tukey;EndpointSuffix=core.windows.net\nAZURE_STORAGE_CONTAINER_NAME=fichaje-dev\n</code></pre>"},{"location":"fichaje_app/onboarding/entorno/#crear-contenedor-si-no-existe","title":"Crear Contenedor (si no existe)","text":"<pre><code>// Ejecutar una vez\nconst { BlobServiceClient } = require(\"@azure/storage-blob\");\nconst blobServiceClient = BlobServiceClient.fromConnectionString(\n  process.env.AZURE_STORAGE_CONNECTION_STRING\n);\nconst containerClient = blobServiceClient.getContainerClient(\"fichaje-dev\");\nawait containerClient.createIfNotExists();\n</code></pre>"},{"location":"fichaje_app/onboarding/entorno/#datos-de-prueba","title":"\ud83d\udd10 Datos de Prueba","text":""},{"location":"fichaje_app/onboarding/entorno/#crear-usuario-de-prueba","title":"Crear Usuario de Prueba","text":"<pre><code>-- En SQL Server\nINSERT INTO EMPRESA (nombre, activo)\nVALUES ('Empresa Test', 1);\n\n-- Obtener id_empresa generado\nDECLARE @id_empresa INT = SCOPE_IDENTITY();\n\n-- Crear usuario admin\n-- Password: \"admin123\" (hasheado con bcrypt)\nINSERT INTO USUARIOS (nombre, email, password, rol, id_empresa, activo)\nVALUES (\n  'Admin Test',\n  'admin@test.com',\n  '$2b$10$ejemplo_hash_bcrypt_aqui',\n  'admin',\n  @id_empresa,\n  1\n);\n</code></pre> <p>O usar el endpoint de superadmin (si est\u00e1 configurado):</p> <pre><code>POST http://localhost:3000/empresa/crear-empresa\n{\n  \"nombre\": \"Empresa Test\",\n  \"usuario\": \"admin\",\n  \"password\": \"admin123\"\n}\n</code></pre>"},{"location":"fichaje_app/onboarding/entorno/#login-de-prueba","title":"Login de Prueba","text":"<pre><code>POST http://localhost:3000/auth/login\nContent-Type: application/json\n\n{\n  \"email\": \"admin@test.com\",\n  \"password\": \"admin123\"\n}\n</code></pre> <p>Respuesta:</p> <pre><code>{\n  \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n  \"user\": {\n    \"id\": 1,\n    \"nombre\": \"Admin Test\",\n    \"empresa\": 1,\n    \"rol\": \"admin\"\n  }\n}\n</code></pre>"},{"location":"fichaje_app/onboarding/entorno/#herramientas-recomendadas","title":"\ud83d\udee0\ufe0f Herramientas Recomendadas","text":""},{"location":"fichaje_app/onboarding/entorno/#vs-code-extensions","title":"VS Code Extensions","text":"<pre><code>{\n  \"recommendations\": [\n    \"dbaeumer.vscode-eslint\",\n    \"esbenp.prettier-vscode\",\n    \"angular.ng-template\",\n    \"ms-mssql.mssql\",\n    \"humao.rest-client\",\n    \"ms-azuretools.vscode-azurestorage\"\n  ]\n}\n</code></pre>"},{"location":"fichaje_app/onboarding/entorno/#sql-server-management-studio-ssms","title":"SQL Server Management Studio (SSMS)","text":"<p>Descarga: https://aka.ms/ssmsfullsetup</p> <p>\u00datil para:</p> <ul> <li>Explorar base de datos</li> <li>Ejecutar queries</li> <li>Ver estructura de tablas</li> <li>Debug de stored procedures</li> </ul>"},{"location":"fichaje_app/onboarding/entorno/#postman-rest-client","title":"Postman / REST Client","text":"<p>Para probar endpoints de la API:</p> <p>Ejemplo con REST Client (VS Code):</p> <p>Crear archivo <code>api-tests.http</code>:</p> <pre><code>### Login\nPOST http://localhost:3000/auth/login\nContent-Type: application/json\n\n{\n  \"email\": \"admin@test.com\",\n  \"password\": \"admin123\"\n}\n\n### Obtener proyectos (requiere token)\nGET http://localhost:3000/proyectos\nAuthorization: Bearer {{token}}\n</code></pre>"},{"location":"fichaje_app/onboarding/entorno/#troubleshooting","title":"\ud83d\udc1b Troubleshooting","text":""},{"location":"fichaje_app/onboarding/entorno/#error-cannot-connect-to-sql-server","title":"Error: \"Cannot connect to SQL Server\"","text":"<p>Soluci\u00f3n:</p> <ol> <li>Verificar que SQL Server est\u00e9 corriendo</li> <li>Verificar nombre de instancia (<code>KONGSERVER</code>)</li> <li>Habilitar TCP/IP en SQL Server Configuration Manager</li> <li>Verificar firewall</li> </ol> <pre><code># Verificar conexi\u00f3n\nsqlcmd -S localhost\\KONGSERVER -U tu_usuario -P tu_password\n</code></pre>"},{"location":"fichaje_app/onboarding/entorno/#error-jwt-secret-is-not-defined","title":"Error: \"JWT secret is not defined\"","text":"<p>Soluci\u00f3n: Aseg\u00farate de que <code>JWT_SECRET</code> est\u00e9 en tu <code>.env</code>:</p> <pre><code>JWT_SECRET=una_clave_secreta_muy_larga_y_segura\n</code></pre>"},{"location":"fichaje_app/onboarding/entorno/#error-azure-blob-storage-connection-failed","title":"Error: \"Azure Blob Storage connection failed\"","text":"<p>Soluci\u00f3n:</p> <ol> <li>Verificar Connection String</li> <li>Verificar que el contenedor existe</li> <li>Verificar permisos de la cuenta</li> </ol>"},{"location":"fichaje_app/onboarding/entorno/#error-port-3000-already-in-use","title":"Error: \"Port 3000 already in use\"","text":"<p>Soluci\u00f3n:</p> <pre><code># Windows\nnetstat -ano | findstr :3000\ntaskkill /PID &lt;PID&gt; /F\n\n# Cambiar puerto en .env\nPORT=3001\n</code></pre>"},{"location":"fichaje_app/onboarding/entorno/#error-module-not-found","title":"Error: \"Module not found\"","text":"<p>Soluci\u00f3n:</p> <pre><code># Limpiar node_modules y reinstalar\nrm -rf node_modules package-lock.json\nnpm install\n</code></pre>"},{"location":"fichaje_app/onboarding/entorno/#frontend-no-se-conecta-al-backend","title":"Frontend no se conecta al Backend","text":"<p>Soluci\u00f3n:</p> <ol> <li>Verificar CORS en backend (<code>server.js</code>):</li> </ol> <pre><code>app.use(cors());\n</code></pre> <ol> <li>Verificar URL en <code>environment.ts</code>:</li> </ol> <pre><code>apiUrl: \"http://localhost:3000\";\n</code></pre>"},{"location":"fichaje_app/onboarding/entorno/#verificar-instalacion","title":"\ud83d\udcca Verificar Instalaci\u00f3n","text":""},{"location":"fichaje_app/onboarding/entorno/#checklist-de-verificacion","title":"Checklist de Verificaci\u00f3n","text":"<ul> <li>[ ] Backend inicia sin errores</li> <li>[ ] Frontend inicia sin errores</li> <li>[ ] Conexi\u00f3n a SQL Server exitosa</li> <li>[ ] Login funciona</li> <li>[ ] Puedes ver datos en la aplicaci\u00f3n</li> <li>[ ] Azure Blob Storage conectado (si aplica)</li> </ul>"},{"location":"fichaje_app/onboarding/entorno/#script-de-verificacion","title":"Script de Verificaci\u00f3n","text":"<p>Crear <code>verify-setup.js</code> en backend:</p> <pre><code>const { sequelize } = require(\"./config/dbConfig\");\nconst db = require(\"./Model\");\n\nasync function verify() {\n  try {\n    // 1. Verificar conexi\u00f3n DB\n    await sequelize.authenticate();\n    console.log(\"\u2705 Conexi\u00f3n a base de datos OK\");\n\n    // 2. Verificar modelos\n    const empresas = await db.EMPRESA.count();\n    console.log(`\u2705 Modelos OK (${empresas} empresas en BD)`);\n\n    // 3. Verificar variables de entorno\n    const required = [\"JWT_SECRET\", \"DB_NAME\", \"PORT\"];\n    const missing = required.filter((key) =&gt; !process.env[key]);\n    if (missing.length &gt; 0) {\n      console.log(`\u274c Faltan variables: ${missing.join(\", \")}`);\n    } else {\n      console.log(\"\u2705 Variables de entorno OK\");\n    }\n\n    console.log(\"\\n\ud83c\udf89 Setup completo!\");\n  } catch (error) {\n    console.error(\"\u274c Error:\", error.message);\n  }\n  process.exit(0);\n}\n\nverify();\n</code></pre> <p>Ejecutar:</p> <pre><code>node verify-setup.js\n</code></pre>"},{"location":"fichaje_app/onboarding/entorno/#siguiente-paso","title":"\ud83d\ude80 Siguiente Paso","text":"<p>Una vez configurado el entorno:</p> <ol> <li>Lee Introducci\u00f3n al Proyecto si no lo has hecho</li> <li>Explora Vista General de la Arquitectura</li> <li>Revisa Convenciones de C\u00f3digo</li> <li>\u00a1Empieza a desarrollar!</li> </ol> <p>\u00bfProblemas? Contacta al equipo t\u00e9cnico interno.</p>"},{"location":"fichaje_app/onboarding/intro/","title":"Introducci\u00f3n al Proyecto Fichaje","text":"<p>\u00a1Bienvenido al equipo de desarrollo de Fichaje! \ud83d\udc4b</p> <p>Esta gu\u00eda te ayudar\u00e1 a entender el proyecto y comenzar a contribuir r\u00e1pidamente.</p>"},{"location":"fichaje_app/onboarding/intro/#que-es-fichaje","title":"\ud83c\udfaf \u00bfQu\u00e9 es Fichaje?","text":"<p>Fichaje es una aplicaci\u00f3n empresarial completa para la gesti\u00f3n integral de servicios y recursos humanos. Permite a las empresas:</p> <ul> <li>\u23f0 Control de Asistencia: Fichaje de entrada/salida con geolocalizaci\u00f3n</li> <li>\ud83d\udcca Gesti\u00f3n de Proyectos: Proyectos, \u00f3rdenes de trabajo y asignaciones</li> <li>\ud83d\udcdd Partes de Trabajo: Seguimiento de tiempo por proyecto/actividad</li> <li>\ud83d\udcb0 Notas de Gasto: Gesti\u00f3n de gastos con tickets digitales</li> <li>\ud83d\udcc4 Albaranes: Facturaci\u00f3n y cobros</li> <li>\ud83c\udfd6\ufe0f Vacaciones: Solicitudes y aprobaciones</li> <li>\ud83d\udcc8 Estad\u00edsticas: Reportes y an\u00e1lisis de datos</li> </ul>"},{"location":"fichaje_app/onboarding/intro/#contexto-del-negocio","title":"\ud83c\udfe2 Contexto del Negocio","text":""},{"location":"fichaje_app/onboarding/intro/#multi-empresa-multi-tenancy","title":"Multi-empresa (Multi-tenancy)","text":"<p>El sistema est\u00e1 dise\u00f1ado para dar servicio a m\u00faltiples empresas desde una \u00fanica instalaci\u00f3n:</p> <ul> <li>Cada empresa tiene su propia configuraci\u00f3n</li> <li>Los datos est\u00e1n completamente aislados entre empresas</li> <li>Un superadmin gestiona todas las empresas</li> <li>Cada empresa tiene sus propios administradores</li> </ul>"},{"location":"fichaje_app/onboarding/intro/#roles-de-usuario-permisos","title":"Roles de Usuario (Permisos)","text":"<p>El sistema maneja 3 roles principales de acceso:</p>"},{"location":"fichaje_app/onboarding/intro/#1-superadmin","title":"1. Superadmin","text":"<ul> <li>Rol interno de nuestra empresa (desarrolladora/gestora).</li> <li>Controla el alta y gesti\u00f3n de las empresas clientes.</li> </ul>"},{"location":"fichaje_app/onboarding/intro/#2-admin-administrador-de-empresa","title":"2. Admin (Administrador de Empresa)","text":"<ul> <li>Acceso al panel de gesti\u00f3n de la empresa.</li> <li>Nota importante: Solo disponible si la empresa NO est\u00e1 vinculada al ERP (o funcionalidad limitada si lo est\u00e1).</li> </ul>"},{"location":"fichaje_app/onboarding/intro/#3-usuario","title":"3. Usuario","text":"<ul> <li>Acceso b\u00e1sico a la aplicaci\u00f3n (fichaje, partes, etc.).</li> </ul> <p>(Ya no existen roles espec\u00edficos de \"Manager\" o \"RRHH\")</p>"},{"location":"fichaje_app/onboarding/intro/#categorias-laborales","title":"Categor\u00edas Laborales","text":"<p>M\u00e1s all\u00e1 de los permisos de acceso (Roles), cada usuario tiene una categor\u00eda profesional que define su operativa diaria:</p>"},{"location":"fichaje_app/onboarding/intro/#1-operario","title":"1. Operario","text":"<ul> <li>Realiza fichajes y partes de trabajo est\u00e1ndar.</li> </ul>"},{"location":"fichaje_app/onboarding/intro/#2-tecnico","title":"2. T\u00e9cnico","text":"<ul> <li>Tiene permisos adicionales sobre \u00d3rdenes de Trabajo (OTs).</li> <li>Puede realizar acciones t\u00e9cnicas espec\u00edficas en las OTs asignadas.</li> </ul>"},{"location":"fichaje_app/onboarding/intro/#3-administrativo","title":"3. Administrativo","text":"<ul> <li>Actualmente funcionalmente igual al resto, reservado para uso futuro.</li> </ul>"},{"location":"fichaje_app/onboarding/intro/#conceptos-clave","title":"\ud83d\udd11 Conceptos Clave","text":""},{"location":"fichaje_app/onboarding/intro/#1-fichaje-y-asistencia","title":"1. Fichaje y Asistencia","text":"<p>Los empleados registran su entrada y salida mediante la aplicaci\u00f3n:</p> <pre><code>Usuario \u2192 Fichar Entrada \u2192 CONTROL_ASISTENCIAS (BD)\n                         \u2193\n                    (si parte_auto = true)\n                         \u2193\n                    PARTES_TRABAJO (BD)\n</code></pre> <p>Caracter\u00edsticas:</p> <ul> <li>Geolocalizaci\u00f3n obligatoria</li> <li>Validaci\u00f3n de horarios</li> <li>Creaci\u00f3n autom\u00e1tica de partes (opcional por empresa)</li> </ul>"},{"location":"fichaje_app/onboarding/intro/#2-proyectos-y-ordenes-de-trabajo","title":"2. Proyectos y \u00d3rdenes de Trabajo","text":"<p>Jerarqu\u00eda de trabajo:</p> <pre><code>PROYECTO\n  \u2514\u2500\u2500 ORDEN_TRABAJO (OT)\n        \u251c\u2500\u2500 PARTES_TRABAJO (tiempo empleados)\n        \u2514\u2500\u2500 CABECERA (albar\u00e1n/factura)\n              \u251c\u2500\u2500 DETALLES_DOC (l\u00edneas)\n              \u2514\u2500\u2500 COBROS_DOC (pagos)\n</code></pre> <p>Flujo t\u00edpico:</p> <ol> <li>Se crea un PROYECTO (ej: \"Instalaci\u00f3n el\u00e9ctrica Edificio A\")</li> <li>Se generan \u00d3RDENES DE TRABAJO (ej: \"OT-001: Cableado planta 1\")</li> <li>Los empleados registran PARTES DE TRABAJO en las OTs</li> <li>Al finalizar, se genera ALBAR\u00c1N con materiales y mano de obra</li> <li>Se registran COBROS del cliente</li> </ol>"},{"location":"fichaje_app/onboarding/intro/#3-parte-auto","title":"3. Parte Auto","text":"<p>Configuraci\u00f3n importante por empresa (<code>CONFIG_EMPRESA.parte_auto</code>):</p> <ul> <li>true: Al fichar entrada/salida, se crea autom\u00e1ticamente un parte de trabajo</li> <li>false: El empleado debe crear manualmente los partes</li> </ul> <p>Impacto en el c\u00f3digo:</p> <pre><code>// En asistenciaController.js\nconst parteAuto = await checkParteAuto(empresa);\nif (parteAuto) {\n  // Crear parte autom\u00e1ticamente\n  await db.PARTES_TRABAJO.create({...});\n}\n</code></pre>"},{"location":"fichaje_app/onboarding/intro/#4-notas-de-gasto","title":"4. Notas de Gasto","text":"<p>Los empleados pueden:</p> <ul> <li>Crear notas de gasto</li> <li>A\u00f1adir l\u00edneas de gasto</li> <li>Adjuntar tickets (Azure Blob Storage)</li> <li>Enviar a aprobaci\u00f3n</li> </ul> <p>Estados:</p> <ul> <li><code>borrador</code>: En edici\u00f3n</li> <li><code>pendiente</code>: Enviada a aprobaci\u00f3n</li> <li><code>aprobada</code>: Aprobada</li> <li><code>rechazada</code>: Rechazada</li> </ul>"},{"location":"fichaje_app/onboarding/intro/#modulos-principales","title":"\ud83d\udcda M\u00f3dulos Principales","text":""},{"location":"fichaje_app/onboarding/intro/#backend","title":"Backend","text":"M\u00f3dulo Descripci\u00f3n Archivos clave auth Autenticaci\u00f3n JWT <code>authController.js</code>, <code>authMiddleware.js</code> asistencia Fichajes <code>asistenciaController.js</code>, <code>asistenciaRoutes.js</code> proyectos Gesti\u00f3n de proyectos <code>proyectosController.js</code> partes Partes de trabajo <code>parteController.js</code> albaran Albaranes y facturaci\u00f3n <code>albaranController.js</code> nota-gasto Notas de gasto <code>notaGastoController.js</code> vacaciones Solicitudes de vacaciones <code>vacacionesController.js</code> empresa Gesti\u00f3n de empresas <code>empresaController.js</code>"},{"location":"fichaje_app/onboarding/intro/#frontend","title":"Frontend","text":"M\u00f3dulo Descripci\u00f3n Ubicaci\u00f3n fichar-asistencia Pantalla de fichaje <code>pages/fichar-asistencia/</code> page-proyectos Listado de proyectos <code>pages/page-proyectos/</code> page-ote \u00d3rdenes de trabajo <code>pages/page-ote/</code> listado-fichaje Historial de fichajes <code>pages/listado-fichaje/</code> admin Panel de administraci\u00f3n <code>pages/admin/</code>"},{"location":"fichaje_app/onboarding/intro/#stack-tecnologico","title":"\ud83d\udee0\ufe0f Stack Tecnol\u00f3gico","text":""},{"location":"fichaje_app/onboarding/intro/#backend_1","title":"Backend","text":"<ul> <li>Node.js + Express 5: API REST</li> <li>Sequelize: ORM para SQL Server</li> <li>JWT: Autenticaci\u00f3n stateless</li> <li>bcrypt: Hash de passwords</li> <li>Azure Blob Storage: Almacenamiento de archivos</li> <li>date-fns: Manejo de fechas (en transici\u00f3n desde js-joda)</li> </ul>"},{"location":"fichaje_app/onboarding/intro/#frontend_1","title":"Frontend","text":"<ul> <li>Angular 19: Framework principal</li> <li>Angular Material: Componentes UI</li> <li>Bootstrap 5: Layout y utilidades</li> <li>RxJS: Programaci\u00f3n reactiva</li> <li>ngx-charts: Gr\u00e1ficos</li> <li>FullCalendar: Calendario de eventos</li> <li>date-fns: Manejo de fechas (en transici\u00f3n desde js-joda)</li> </ul>"},{"location":"fichaje_app/onboarding/intro/#base-de-datos","title":"Base de Datos","text":"<ul> <li>SQL Server: Base de datos principal</li> <li>\u26a0\ufe0f Access (Legacy): Algunas consultas a\u00fan usan Access (ver Decisiones Arquitect\u00f3nicas)</li> </ul>"},{"location":"fichaje_app/onboarding/intro/#primeros-pasos","title":"\ud83d\ude80 Primeros Pasos","text":""},{"location":"fichaje_app/onboarding/intro/#1-leer-la-documentacion","title":"1. Leer la Documentaci\u00f3n","text":"<p>Orden recomendado:</p> <ol> <li>\u2705 Esta introducci\u00f3n (est\u00e1s aqu\u00ed)</li> <li>\ud83d\udcd6 Configuraci\u00f3n del Entorno</li> <li>\ud83c\udfd7\ufe0f Vista General de la Arquitectura</li> <li>\u26a0\ufe0f Decisiones Arquitect\u00f3nicas - MUY IMPORTANTE</li> <li>\ud83d\udcdd Convenciones de C\u00f3digo</li> </ol>"},{"location":"fichaje_app/onboarding/intro/#2-configurar-tu-entorno","title":"2. Configurar tu Entorno","text":"<p>Sigue la gu\u00eda de Configuraci\u00f3n del Entorno para:</p> <ul> <li>Instalar dependencias</li> <li>Configurar base de datos</li> <li>Configurar variables de entorno</li> <li>Ejecutar el proyecto localmente</li> </ul>"},{"location":"fichaje_app/onboarding/intro/#3-explorar-el-codigo","title":"3. Explorar el C\u00f3digo","text":"<p>Backend - Comienza por:</p> <ol> <li><code>server.js</code> - Punto de entrada</li> <li><code>routes/authRoutes.js</code> - Rutas de autenticaci\u00f3n</li> <li><code>controllers/asistenciaController.js</code> - L\u00f3gica de fichaje</li> <li><code>Model/init-models.js</code> - Modelos de BD</li> </ol> <p>Frontend - Comienza por:</p> <ol> <li><code>app.routes.ts</code> - Configuraci\u00f3n de rutas</li> <li><code>services/auth.service.ts</code> - Servicio de autenticaci\u00f3n</li> <li><code>pages/fichar-asistencia/</code> - Componente de fichaje</li> <li><code>interface/usuario.ts</code> - Interfaces principales</li> </ol>"},{"location":"fichaje_app/onboarding/intro/#4-hacer-tu-primera-contribucion","title":"4. Hacer tu Primera Contribuci\u00f3n","text":"<p>Sugerencias para empezar:</p> <ol> <li>Corregir un bug peque\u00f1o</li> <li>Mejorar documentaci\u00f3n de c\u00f3digo</li> <li>A\u00f1adir validaciones</li> <li>Escribir tests (actualmente no hay)</li> </ol>"},{"location":"fichaje_app/onboarding/intro/#advertencias-importantes","title":"\u26a0\ufe0f Advertencias Importantes","text":""},{"location":"fichaje_app/onboarding/intro/#base-de-datos-access-critico","title":"\ud83d\udd34 Base de Datos Access (CR\u00cdTICO)","text":"<p>[!CAUTION] El sistema tiene una dependencia legacy con Access que coexiste con SQL Server. Lee Decisiones Arquitect\u00f3nicas antes de modificar cualquier c\u00f3digo relacionado con configuraci\u00f3n de empresa o emails.</p>"},{"location":"fichaje_app/onboarding/intro/#manejo-de-fechas","title":"\ud83d\udfe1 Manejo de Fechas","text":"<p>El manejo de fechas con Sequelize y SQL Server es complicado:</p> <ul> <li>Usar date-fns para c\u00f3digo nuevo (js-joda en c\u00f3digo legacy)</li> <li>Ver Gu\u00eda de Fechas</li> </ul>"},{"location":"fichaje_app/onboarding/intro/#multi-tenancy","title":"\ud83d\udfe1 Multi-tenancy","text":"<p>SIEMPRE filtrar por empresa:</p> <pre><code>// \u2705 BIEN\nconst { empresa } = req.user;\nconst datos = await db.TABLA.findAll({\n  where: { id_empresa: empresa },\n});\n\n// \u274c MAL - Expone datos de todas las empresas\nconst datos = await db.TABLA.findAll();\n</code></pre>"},{"location":"fichaje_app/onboarding/intro/#testing","title":"\ud83e\uddea Testing","text":"<p>[!WARNING] El proyecto actualmente NO tiene tests automatizados. Esto es deuda t\u00e9cnica prioritaria.</p> <p>Al desarrollar:</p> <ul> <li>Prueba manualmente todos los casos</li> <li>Documenta los pasos de prueba</li> <li>Considera escribir tests para tu c\u00f3digo nuevo</li> </ul>"},{"location":"fichaje_app/onboarding/intro/#recursos-y-ayuda","title":"\ud83d\udcde Recursos y Ayuda","text":""},{"location":"fichaje_app/onboarding/intro/#documentacion-interna","title":"Documentaci\u00f3n Interna","text":"<ul> <li>Arquitectura</li> <li>Decisiones T\u00e9cnicas</li> <li>Convenciones</li> </ul>"},{"location":"fichaje_app/onboarding/intro/#documentacion-externa","title":"Documentaci\u00f3n Externa","text":"<ul> <li>Sequelize Docs</li> <li>Angular Docs</li> <li>Express Docs</li> <li>js-joda Docs</li> </ul>"},{"location":"fichaje_app/onboarding/intro/#equipo","title":"Equipo","text":"<ul> <li>Contacta al equipo t\u00e9cnico interno para dudas</li> <li>Revisa el c\u00f3digo existente como referencia</li> <li>Pregunta antes de hacer cambios grandes</li> </ul>"},{"location":"fichaje_app/onboarding/intro/#glosario","title":"\ud83c\udf93 Glosario","text":"T\u00e9rmino Significado OT Orden de Trabajo Parte Parte de trabajo (registro de tiempo) Fichaje Registro de entrada/salida Parte Auto Creaci\u00f3n autom\u00e1tica de partes al fichar Multi-tenancy M\u00faltiples empresas en un sistema Superadmin Administrador global del sistema"},{"location":"fichaje_app/onboarding/intro/#checklist-de-onboarding","title":"\u2705 Checklist de Onboarding","text":"<ul> <li>[ ] Leer toda la documentaci\u00f3n</li> <li>[ ] Configurar entorno de desarrollo</li> <li>[ ] Ejecutar backend localmente</li> <li>[ ] Ejecutar frontend localmente</li> <li>[ ] Explorar la base de datos</li> <li>[ ] Hacer login como diferentes roles</li> <li>[ ] Probar flujo de fichaje</li> <li>[ ] Probar creaci\u00f3n de proyecto</li> <li>[ ] Revisar c\u00f3digo de un m\u00f3dulo completo</li> <li>[ ] Hacer tu primera contribuci\u00f3n</li> </ul> <p>Siguiente: Configuraci\u00f3n del Entorno</p>"},{"location":"fichaje_app/otros/recursos/","title":"Recursos Fichaje App","text":"<p>Aqu\u00ed podemos colocar enlaces a herramientas, diagramas o documentos externos.</p>"},{"location":"proyecto_ejemplo/","title":"Proyecto Ejemplo","text":"<p>Este es el proyecto de ejemplo. Aqu\u00ed encontrar\u00e1s toda la documentaci\u00f3n espec\u00edfica:</p> <ul> <li>Onboarding</li> <li>Arquitectura</li> <li>Decisiones t\u00e9cnicas</li> <li>Gu\u00edas y convenciones</li> </ul>"},{"location":"proyecto_ejemplo/arquitectura/decisiones/","title":"Decisiones t\u00e9cnicas Proyecto Ejemplo","text":""},{"location":"proyecto_ejemplo/arquitectura/decisiones/#adr-001-base-de-datos-principal","title":"ADR-001: Base de datos principal","text":"<ul> <li>Decisi\u00f3n: Usar PostgreSQL</li> <li>Motivo: Consistencia y soporte SQL completo</li> <li>Alternativas: MySQL, MongoDB</li> <li>Consecuencias: Menos flexibilidad, m\u00e1s fiabilidad</li> </ul>"},{"location":"proyecto_ejemplo/arquitectura/overview/","title":"Arquitectura Proyecto Ejemplo","text":"<p>Visi\u00f3n general del sistema y componentes principales.</p>"},{"location":"proyecto_ejemplo/arquitectura/overview/#principios","title":"Principios","text":"<ul> <li>Simple antes que complejo</li> <li>Decisiones expl\u00edcitas</li> </ul>"},{"location":"proyecto_ejemplo/guias/convenciones/","title":"Gu\u00edas y convenciones Proyecto Ejemplo","text":"<ul> <li>Commits claros</li> <li>PRs peque\u00f1os</li> <li>Docs actualizadas</li> </ul>"},{"location":"proyecto_ejemplo/onboarding/entorno/","title":"Entorno de desarrollo Proyecto Ejemplo","text":""},{"location":"proyecto_ejemplo/onboarding/entorno/#requisitos","title":"Requisitos","text":"<ul> <li>Git</li> <li>Node.js</li> <li>Docker</li> </ul>"},{"location":"proyecto_ejemplo/onboarding/entorno/#setup","title":"Setup","text":"<ol> <li>Clonar repositorios</li> <li>Instalar dependencias</li> <li>Ejecutar servicios</li> </ol>"},{"location":"proyecto_ejemplo/onboarding/intro/","title":"Onboarding Proyecto Ejemplo","text":"<p>Objetivo: que cualquier desarrollador nuevo pueda arrancar sin ayuda.</p> <p>Incluye conceptos, responsables y links importantes.</p>"},{"location":"proyecto_ejemplo/otros/recursos/","title":"Recursos Proyecto Ejemplo","text":"<p>Aqu\u00ed podemos colocar enlaces a herramientas, diagramas o documentos externos.</p>"}]}